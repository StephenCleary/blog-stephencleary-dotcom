<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Extension-Based Types</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="There’s a new paradign rising in .NET: extension-based types (EBTs)." />
    <link rel="canonical" href="https://blog.stephencleary.com/2010/01/extension-based-types.html" />
    
    <link rel="alternate" type="application/rss+xml" title="Stephen Cleary (the blog)" href="http://feeds.feedburner.com/NitoPrograms" />
    
    <link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/bootswatch/3.2.0/spacelab/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" />
    <style type="text/css">/* Layout Styles */
/* ----------------------------------------------------------*/

body {
    padding-top: 50px;
}

.affix {
    top: 70px;
    bottom: 0;
    overflow-y: auto;
}

.navbar-brand {
    font-weight: bold;
}

.navbar-brand-container.active>a, .navbar-brand-container.active>a:hover, .navbar-brand-container.active>a:focus {
    color: #3399f3;
    background-color: transparent;
}

.sidebar {
    margin-top: 20px;
}

.sidenavitem {
    height: auto;
}

.sidebar img {
    /* Responsive images */
    display: inline-block;
    height: auto;
    max-width: 100%;
}

@media(max-width:767px) {
    .affix {
        position: static;
    }
}

div .vertical-margins {
    margin-top: 10px;
    margin-bottom: 10px;
}

.page-header {
    margin-top: 20px;
}

.center {
    text-align: center;
}

.project-icon {
    height: 128px;
    width: 128px;
}

.list-group-item h2 {
    margin-top: 10px;
}

/* Fixes for Google Custom Search in a Bootstrap page */
/* ----------------------------------------------------------*/
.google, .google *, .google *:before, .google *:after {
    -webkit-box-sizing: content-box;
    -moz-box-sizing: content-box;
    box-sizing: content-box;
}

.google table {
    border-collapse: separate;
}

.gsc-input-box {
    height: auto !important;
}

/* Fixes for Amazon widget in Bootstrap page */
.amzn_wdgt * {
    -webkit-box-sizing: content-box;
    -moz-box-sizing: content-box;
    box-sizing: content-box;
}

/* Post styles */
/* ----------------------------------------------------------*/

code {
    background-color: #F2F3F9;
    color: inherit;
}

.post img {
    /* Responsive images */
    display: inline-block;
    height: auto;
    max-width: 100%;
}

.post .table {
    table-layout: fixed;
}

.post .table code {
    white-space: normal;
}

.post .yes {
    color: #008000;
}

.post .no {
    color: #FF0000;
}

/* Syntax highlighting styles */
/* ----------------------------------------------------------*/

.highlight  { background: #ffffff; }
.highlight .c { color: #008000 } /* Comment */
.highlight .k { color: #0000ff } /* Keyword */
.highlight .cm { color: #008000 } /* Comment.Multiline */
.highlight .cp { color: #0000ff } /* Comment.Preproc */
.highlight .c1 { color: #008000 } /* Comment.Single */
.highlight .cs { color: #008000 } /* Comment.Special */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gh { font-weight: bold } /* Generic.Heading */
.highlight .gp { font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { font-weight: bold } /* Generic.Subheading */
.highlight .kc { color: #0000ff } /* Keyword.Constant */
.highlight .kd { color: #0000ff } /* Keyword.Declaration */
.highlight .kn { color: #0000ff } /* Keyword.Namespace */
.highlight .kp { color: #0000ff } /* Keyword.Pseudo */
.highlight .kr { color: #0000ff } /* Keyword.Reserved */
.highlight .kt { color: #2b91af } /* Keyword.Type */
.highlight .s { color: #a31515 } /* Literal.String */
.highlight .nc { color: #2b91af } /* Name.Class */
.highlight .ow { color: #0000ff } /* Operator.Word */
.highlight .sb { color: #a31515 } /* Literal.String.Backtick */
.highlight .sc { color: #a31515 } /* Literal.String.Char */
.highlight .sd { color: #a31515 } /* Literal.String.Doc */
.highlight .s2 { color: #a31515 } /* Literal.String.Double */
.highlight .se { color: #a31515 } /* Literal.String.Escape */
.highlight .sh { color: #a31515 } /* Literal.String.Heredoc */
.highlight .si { color: #a31515 } /* Literal.String.Interpol */
.highlight .sx { color: #a31515 } /* Literal.String.Other */
.highlight .sr { color: #a31515 } /* Literal.String.Regex */
.highlight .s1 { color: #a31515 } /* Literal.String.Single */
.highlight .ss { color: #a31515 } /* Literal.String.Symbol */

/* Comments */
/* ----------------------------------------------------------*/

.comment-container {
    margin-top: 10px;
}

.comment-container > .comment-container {
    margin-left: 2em;
}

.comment-container > .comment-container > .comment-container > .comment-container > .comment-container {
    margin-left: 0;
}

/* Correct anchor links in comments (they are offset by the height of the fixed header) */
.comment-anchor {
    display: block;
    position: relative;
    top: -60px;
    visibility: hidden;
}

.comment-author-profile-image {
    height: 80px;
    width: 80px;
    margin-right: 10px;
}
</style>
    
    <meta name="application-name" content="Stephen Cleary" />
    <link rel="search" type="application/opensearchdescription+xml" href="https://stephencleary.com/opensearch.xml" title="Cleary Search">
    <link rel="apple-touch-icon" sizes="57x57" href="https://stephencleary.com/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://stephencleary.com/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://stephencleary.com/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://stephencleary.com/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://stephencleary.com/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://stephencleary.com/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://stephencleary.com/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://stephencleary.com/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" href="https://stephencleary.com/icons/apple-touch-icon.png"/>
    <link rel="apple-touch-icon-precomposed" href="https://stephencleary.com/icons/apple-touch-icon-precomposed.png"/>
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-196x196.png" sizes="196x196">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-32x32.png" sizes="32x32">
    
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <div class="navbar-brand-container"><a class="navbar-brand" href="https://stephencleary.com">Stephen Cleary</a></div>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
            <li  class="active"  ><a href="https://blog.stephencleary.com">Blog</a></li>
            <li ><a href="https://stephencleary.com/videos/">Videos</a></li>
            <li  ><a href="https://stephencleary.com/projects/">Projects</a></li>
            <li  ><a href="https://stephencleary.com/publications/">Publications</a></li>
            <li  ><a href="https://stephencleary.com/book/">Book</a></li>
            <li  ><a href="https://stephencleary.com/contact/">Contact</a></li>
            <li><a href="http://feeds.feedburner.com/NitoPrograms"><i class="fa fa-rss-square fa-lg"></i></a></li>
            <li  ><a href="https://stephencleary.com/search/"><i class="fa fa-search"></i></a></li>
        </ul>
    </div>
</nav>

    <div class="container-fluid">
        <div class="col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3">
            <div class="post">

  <header>
      <div class="page-header">
          <h1>Extension-Based Types</h1>
          <small><time datetime="2010-01-05">Jan 5, 2010</time> &bull; <a id="comment-counter" href="#comments">Comments</a></small>
      </div>
  </header>

  <article>
  <p>There’s a new paradign rising in .NET: <em>extension-based types (EBTs)</em>.</p>

<h2 id="introduction">Introduction</h2>

<p>It’s an exciting time to be a .NET developer. I’m reminded of the time when Boost was young, and programmers were first starting to realize the capabilities of templates. Generic programming became a powerful mainstream paradign, producing techniques now described in <a href="http://www.amazon.com/gp/product/0201734842?ie=UTF8&amp;tag=stepheclearys-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0201734842">C++ Templates</a> and <a href="http://www.amazon.com/gp/product/0321227255?ie=UTF8&amp;tag=stepheclearys-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0321227255">C++ Template Metaprogramming</a>.</p>

<p>Currently, we’re seeing a similar transformation taking place with C# generics. The adoption of generics is just beginning to reach a critical mass, where new and inventive approches are discovered. The thrust towards generic programming is driven by a desire for higher levels of <em>abstraction</em> and <em>extensibility</em>.</p>

<p>The EBT approach allows writing .NET libraries that permit an unprecedented level of end-user extensibility while discouraging leaky abstractions. This approach combines the clean abstraction of “programming to an interface” with the convenience of additional, more complex operations (some of which may be contributed by end-user code).</p>

<h2 id="extension-based-types">Extension-Based Types</h2>

<p>An EBT is a type that is primarily defined through extension methods on interfaces. Only a few core methods are defined on the interfaces themselves. Properly-designed EBTs have the minimal set of methods defined in their interface (often only one, and sometimes none).</p>

<p>EBTs are useful for end-user extensibility (and raising the level of abstraction), but they also have a few “gotchas” since they are dependent on the compile-time nature of method overload resolution.</p>

<p>Here’s an example of an EBT that defines a single method, <code>MethodA</code>:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IMyInterface</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">MyImplementation</span> <span class="p">:</span> <span class="n">IMyInterface</span> <span class="p">{</span> <span class="p">}</span>
    
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">MyMethods</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IMyInterface</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IMyInterface.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyImplementation</span><span class="p">();</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IMyInterface.MethodA()&quot;</span>
    
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h2 id="simple-inheritance">Simple Inheritance</h2>

<p>EBT inheritance is performed using interface inheritance. Here’s an example of a base interface that defines <code>MethodA</code> and a derived interface defining <code>MethodB</code>; the derived interface ends up supporting both methods:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IDerived</span> <span class="p">:</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Derived</span> <span class="p">:</span> <span class="n">IDerived</span> <span class="p">{</span> <span class="p">}</span>
    
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">MyMethods</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBase</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IBase.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodB</span><span class="p">(</span><span class="k">this</span> <span class="n">IDerived</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IDerived.MethodB()&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">();</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IBase.MethodA()&quot;</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">MethodB</span><span class="p">();</span> <span class="c1">// Prints: &quot;IDerived.MethodB()&quot;</span>
    
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h2 id="overriding-inherited-methods-simple-overriding">Overriding Inherited Methods: Simple Overriding</h2>

<p>A derived EBT may override a base EBT method by defining its own method with an identical signature. Here’s a derived type that overrides the <code>MethodA</code> defined by its base type:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Base</span> <span class="p">:</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IDerived</span> <span class="p">:</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Derived</span> <span class="p">:</span> <span class="n">IDerived</span> <span class="p">{</span> <span class="p">}</span>
    
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">MyMethods</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBase</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IBase.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IDerived</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IDerived.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">obj1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Base</span><span class="p">();</span>
        <span class="n">obj1</span><span class="p">.</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IBase.MethodA()&quot;</span>
    
        <span class="kt">var</span> <span class="n">obj2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">();</span>
        <span class="n">obj2</span><span class="p">.</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IDerived.MethodA()&quot;</span>
    
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h2 id="overriding-inherited-methods-invoking-the-base-method">Overriding Inherited Methods: Invoking the Base Method</h2>

<p>In order to invoke the base method when the derived EBT overrides it, the compile-time type of the variable must explicitly be the base type. Here’s an example that invokes the derived and base <code>MethodA</code> implementations on the same object:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IDerived</span> <span class="p">:</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Derived</span> <span class="p">:</span> <span class="n">IDerived</span> <span class="p">{</span> <span class="p">}</span>
    
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">MyMethods</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBase</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IBase.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IDerived</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IDerived.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">d</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">();</span>
        <span class="n">d</span><span class="p">.</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IDerived.MethodA()&quot;</span>
    
        <span class="n">IBase</span> <span class="n">b</span> <span class="p">=</span> <span class="n">d</span><span class="p">;</span>
        <span class="n">b</span><span class="p">.</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IBase.MethodA()&quot;</span>
    
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>For convenience, an “identity transformation method” is usually provided that restricts the type of a subexpression; this way, a separate variable is not necessary. By convention, the identity transformation method is named <code>As{I}</code>. The following example shows how an <code>AsBase</code> method removes the need for the <code>IBase</code> variable:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IDerived</span> <span class="p">:</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Derived</span> <span class="p">:</span> <span class="n">IDerived</span> <span class="p">{</span> <span class="p">}</span>
    
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">MyMethods</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IBase</span> <span class="nf">AsBase</span><span class="p">(</span><span class="k">this</span> <span class="n">IBase</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">@this</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBase</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IBase.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IDerived</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IDerived.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">().</span><span class="n">AsBase</span><span class="p">();</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IBase.MethodA()&quot;</span>
    
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h2 id="overriding-inherited-methods-the-importance-of-compile-time-types">Overriding Inherited Methods: The Importance of Compile-Time Types</h2>

<p>It’s important to note that the compile-time type of the expression is what’s used for method overloading, so the EBT style of overriding inherited methods is <em>not</em> like object-oriented virtual function overriding:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IDerived</span> <span class="p">:</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Derived</span> <span class="p">:</span> <span class="n">IDerived</span> <span class="p">{</span> <span class="p">}</span>
    
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">MyMethods</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IBase</span> <span class="nf">AsBase</span><span class="p">(</span><span class="k">this</span> <span class="n">IBase</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">@this</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBase</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IBase.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IDerived</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IDerived.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">IBase</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">();</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IBase.MethodA()&quot;, NOT &quot;IDervied.MethodA()&quot;</span>
    
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>In fact, even something as minor as missing a <code>using</code> declaration could cause the wrong method to be called. Consider the case where <code>MethodA(this IDerived)</code> is defined in a class in a different namespace. It must be brought into scope via a <code>using</code> declaration before it could be considered by method resolution.</p>

<h2 id="multiple-inheritance">Multiple Inheritance</h2>

<p>Multiple inheritance is supported for EBTs; any ambiguity causes a compiler error:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IBaseA</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IBaseB</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IDerived</span> <span class="p">:</span> <span class="n">IBaseA</span><span class="p">,</span> <span class="n">IBaseB</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Derived</span> <span class="p">:</span> <span class="n">IDerived</span> <span class="p">{</span> <span class="p">}</span>
    
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">MyMethods</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBaseA</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IBaseA.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBaseB</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IBaseB.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">();</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Compiler error: ambiguous</span>
    
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Ambiguity may be resolved by overriding the method in the derived EBT, or by constraining the compile-time type using the identity transformation method. The second approach is more flexible, since it allows any user-defined extensions. This example uses the second approach:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IBaseA</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IBaseB</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IDerived</span> <span class="p">:</span> <span class="n">IBaseA</span><span class="p">,</span> <span class="n">IBaseB</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Derived</span> <span class="p">:</span> <span class="n">IDerived</span> <span class="p">{</span> <span class="p">}</span>
    
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">MyMethods</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IBaseA</span> <span class="nf">AsBaseA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBaseA</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">@this</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBaseA</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IBaseA.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IBaseB</span> <span class="nf">AsBaseB</span><span class="p">(</span><span class="k">this</span> <span class="n">IBaseB</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">@this</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBaseB</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IBaseB.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">();</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">AsBaseA</span><span class="p">().</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IBaseA.MethodA()&quot;</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">AsBaseB</span><span class="p">().</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IBaseB.MethodA()&quot;</span>
    
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h2 id="properties">Properties</h2>

<p>Due to .NET limitations, properties may only be defined on interfaces (there’s no such thing as an “extension property”). However, they may be simulated:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IBase</span> <span class="p">{</span> <span class="kt">int</span> <span class="n">Property</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IDerived</span> <span class="p">:</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Derived</span> <span class="p">:</span> <span class="n">IDerived</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">IBase</span><span class="p">.</span><span class="n">Property</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">GetProperty</span><span class="p">();</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">MyMethods</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IBase</span> <span class="nf">AsBase</span><span class="p">(</span><span class="k">this</span> <span class="n">IBase</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">@this</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="nf">GetProperty</span><span class="p">(</span><span class="k">this</span> <span class="n">IDerived</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IDerived.GetProperty()&quot;</span><span class="p">);</span> <span class="k">return</span> <span class="m">13</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">();</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">GetProperty</span><span class="p">();</span> <span class="c1">// Prints: &quot;IDerived.GetProperty()&quot;</span>
        <span class="kt">int</span> <span class="n">test</span> <span class="p">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">AsBase</span><span class="p">().</span><span class="n">Property</span><span class="p">;</span> <span class="c1">// Prints: &quot;IDerived.GetProperty()&quot;</span>
    
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>One may think of this as the interface holding the property <em>declaration</em> while the extension methods (derived EBT methods) hold the property <em>definition</em>.</p>

<p>Note that the property getter will always call the same derived method, regardless of whether it is accessed through an <code>IBase</code> interface. However, the extension method <code>GetProperty</code> (if it were defined on <code>IBase</code>) would call either the <code>IBase</code> or <code>IDerived</code> implementation, depending on the compile-time type.</p>

<h2 id="limitations-inability-to-override-interface-methods">Limitations: Inability to Override Interface Methods</h2>

<p>If a method is defined in the interface instead of as an extension method, then that method may never be overridden by a derived EBT type:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IBase</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IDerived</span> <span class="p">:</span> <span class="n">IBase</span> <span class="p">{</span> <span class="k">void</span> <span class="n">MethodA</span><span class="p">();</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Derived</span> <span class="p">:</span> <span class="n">IDerived</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">()</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Derived.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">MyMethods</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IBase</span> <span class="nf">AsBase</span><span class="p">(</span><span class="k">this</span> <span class="n">IBase</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">@this</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IBase</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IBase.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">IDerived</span> <span class="nf">AsDerived</span><span class="p">(</span><span class="k">this</span> <span class="n">IDerived</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">@this</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MethodA</span><span class="p">(</span><span class="k">this</span> <span class="n">IDerived</span> <span class="n">@this</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;IDerived.MethodA()&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
    
<span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">obj</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Derived</span><span class="p">();</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;Derived.MethodA()&quot;</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">AsBase</span><span class="p">().</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;IBase.MethodA()&quot;</span>
        <span class="n">obj</span><span class="p">.</span><span class="n">AsDerived</span><span class="p">().</span><span class="n">MethodA</span><span class="p">();</span> <span class="c1">// Prints: &quot;Derived.MethodA()&quot; (NOT &quot;IDerived.MethodA&quot;)</span>
    
        <span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>For this reason, it is important to distill as many methods as possible out of the interface that defines the EBT.</p>

<h2 id="limitations-dependency-on-compile-time-types">Limitations: Dependency on Compile-Time Types</h2>

<p>Code that uses EBTs must “see” all the associated methods in order for overridden derived methods to work properly. The parallel problem for C++ templates eventually resulted in “header file libraries”, where libraries transitioned from dlls to source code that was included in the program using the library.</p>

<p>A similar transition will probably occur if EBTs are embraced. Currently, if EBTs are compiled into a library (e.g., System.Core.dll), then end-user code may supplement but not replace existing behavior.</p>

<h2 id="real-world-examples-from-linq">Real-World Examples from LINQ</h2>

<p>As LINQ continues to evolve, it approaches EBTs. In particular, the <a href="http://msdn.microsoft.com/en-us/library/9eekhta0.aspx"><code>IEnumerable&lt;T&gt;</code></a> interface is extended by the <a href="http://msdn.microsoft.com/en-us/library/system.linq.enumerable.aspx"><code>Enumerable</code></a> class, including an <a href="http://msdn.microsoft.com/en-us/library/bb335435.aspx"><code>AsEnumerable</code></a> identity transformation method. <a href="http://msdn.microsoft.com/en-us/library/bb534852.aspx"><code>IOrderedEnumerable&lt;T&gt;</code></a> is one derived type; the interface adds no methods, but the <code>Enumerable</code> class does. The <a href="http://msdn.microsoft.com/en-us/library/bb351562.aspx"><code>IQueryable&lt;T&gt;</code></a> derived type is extended by <a href="http://msdn.microsoft.com/en-us/library/system.linq.queryable.aspx"><code>Queryable</code></a>. Grouping and ordering follow the same pattern.</p>

<p>The new PLINQ has a similar structure (though the derived <a href="http://msdn.microsoft.com/en-us/library/dd383736(VS.100).aspx"><code>ParallelQuery&lt;T&gt;</code></a> is a class instead of an interface).</p>

<p><a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">Rx</a> (a.k.a. “LINQ to Events”) continues the tradition. <code>IObservable&lt;T&gt;</code>, <code>IObserver&lt;T&gt;</code>, and <code>IScheduler&lt;T&gt;</code> provide basic definitions of types, with extension methods in the <code>Observable</code>, <code>Observer</code>, and <code>Scheduler</code> classes. Rx follows the EBT pattern in defining minimal interfaces; for example, <code>IObservable&lt;T&gt;</code> only defines one method (<code>Subscribe</code>), and extension methods are used to provide 5 overloads for <code>Subscribe</code>. The Rx team has a <a href="http://channel9.msdn.com/posts/J.Van.Gogh/Controlling-concurrency-in-Rx/">video</a> in which they describe some of the design behind <code>IScheduler</code>/<code>Scheduler</code>.</p>

<h2 id="future-blog-posts">Future Blog Posts</h2>

<p>In the (hopefully near) future, I’ll be showing how to use EBTs to do compile-time generic specialization (including partial specialization, generic method specialization, and inheritance specialization). I also intend to cover “namespaces” and wrapper objects. Lots of fun! :)</p>


  </article>
    
    <footer class="hidden-print">
        
        
        <ul class="pager">
            <li class="previous"><a href="/2010/01/view-of-2010.html" title="View of 2010">&larr; Previous Post</a></li>
            <li class="next"><a href="/2010/01/aspnet-mvc-faking-web-services.html" title="ASP.NET MVC Faking Web Services">Next Post &rarr;</a></li>
        </ul>

        <div>Note: Comments are temporarily read-only. If you wish to make a comment, please email me directly.</div>
        <div id="comments"></div>
    </footer>
</div>
        </div>
        <div class="col-sm-2 col-md-3 col-md-offset-0 col-lg-2 col-lg-offset-1 affix hidden-print" data-spy="affix" role="navigation">
            
            
        </div>
        <div class="col-sm-2 sidebar hidden-print">
            <div class="panel panel-default">
                <div class="panel-heading">About Stephen Cleary</div>
                <div class="panel-body">
                    <div class="center"><img src="https://stephencleary.com/www.assets/Me-large.jpg"/></div>
                    <div class="center vertical-margins">Stephen Cleary is a <a href="https://stephencleary.com/god/">Christian</a>, husband, father, and programmer living in Northern Michigan.</div>
                    <div class="center"><a href="http://mvp.microsoft.com/en-us/mvp/Stephen%20Cleary-5000058"><img class="mvp-logo" src="https://stephencleary.com/www.assets/MVP.png"/></a></div>
                </div>
            </div>
            <div class="panel panel-primary">
                <div class="panel-heading">My book</div>
                <div class="panel-body center">
                    <div><a href="https://stephencleary.com/book/"><img src="https://stephencleary.com/www.assets/Book-small.jpg"/></a></div>
                    <div>Available from <a href="http://tinyurl.com/ConcurrencyCookbook">O'Reilly</a> or <a href="http://tinyurl.com/ConcurrencyCookbookAmazon">Amazon</a>.</div>
                    <div data-hide-after="2015-09-18 05-0700" class="hidden"><b><a href="http://tinyurl.com/ConcurrencyCookbook">Ebook is 50% off right now at O'Reilly</a> - use discount code <i>B2S5</i></b></div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">Advertisement</div>
                <div class="panel-body">
                    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2749292939902134" data-ad-slot="7584809820" data-ad-format="auto"></ins>
                </div>
            </div>
            
            <div class="panel panel-primary">
                <div class="panel-heading">Popular Posts</div>
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li><a href="/2012/02/async-and-await.html">Async/await Intro</a></li>
                        <li><a href="/2013/11/there-is-no-thread.html">There Is No Thread</a></li>
                        <li><a href="/2012/07/dont-block-on-async-code.html">Don't Block on Async Code</a></li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">Series</div>
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li><a href="/2016/02/react-redux-todomvc.html">React/Redux TodoMVC</a></li>
                        <li><a href="/2014/04/a-tour-of-task-part-0-overview.html">A Tour of Task</a></li>
                        <li><a href="/2013/10/taskrun-etiquette-and-proper-usage.html">Task.Run Etiquette</a></li>
                        <li><a href="/2013/05/taskrun-vs-backgroundworker-intro.html">Task.Run vs. BackgroundWorker</a></li>
                        <li><a href="/2013/01/async-oop-0-introduction.html">Async OOP</a></li>
                        <li><a href="/2009/04/tcpip-net-sockets-faq.html">TCP/IP .NET Sockets FAQ</a></li>
                        <li><a href="/2013/10/managed-services-roundup.html">Managed Services</a></li>
                        <li><a href="/2009/08/how-to-implement-idisposable-and.html">IDisposable and Finalizers</a></li>
                        <li><a href="/2011/02/option-parsing-introduction.html">Option Parsing</a></li>
                    </ul>
                </div>
            </div>
            
        </div>
    </div>

    <div class="google">
        <gcse:searchresults></gcse:searchresults>
    </div>
    
    <!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript">window.jQuery || document.write('<script src="/lib/jquery-2.1.1.min.js"><\/script>')</script>

<!-- Bootstrap -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script type="text/javascript">window.jQuery.fn.modal || document.write('<script src="/lib/bootstrap.min.js"><\/script>')</script>
<script type="text/javascript">
    (function($) {
        $(function() {
            if ($('body').css('color') !== 'rgb(102, 102, 102)') {
                $('head').prepend('<link rel="stylesheet" href="/lib/bootstrap.min.css" />');
            }
        });
    })(window.jQuery);
</script>

<!-- Font Awesome -->
<span id="facheck" class="fa" style="display:none"></span>
<script type="text/javascript">
    (function($) {
        $(function() {
            if ($('#facheck').css('fontFamily') !== 'FontAwesome') {
                $('head').prepend('<link rel="stylesheet" href="/lib/font-awesome.min.css" />');
            }
        });
    })(window.jQuery);
</script>

<!-- Scroll the sidebar into view (if necessary) -->


<!-- Moment -->
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.6.0/moment.min.js"></script>
<script type="text/javascript">window.moment || document.write('<script src="/lib/moment.min.js"><\/script>')</script>

<!-- Google analytics -->
<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-8910661-5', 'stephencleary.com');
    ga('send', 'pageview');
</script>

<!-- Show appropriate elements based on time -->
<script type="text/javascript">
    (function ($) {
        $(function () {
            var targets = $('[data-hide-after]');
            targets.each(function () {
                var $item = $(this);
                if (moment() < moment($item.attr('data-hide-after'))) {
                    $item.removeClass('hidden');
                }
            });
        });
    })(window.jQuery);
</script>








<script src="/lib/uuid-v3-3.2.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/showdown@1.8.6/dist/showdown.min.js" integrity="sha256-dwhppIrxD8qC6lNulndZgtIm4XBU9zoMd9OUoXzIDAE=" crossorigin="anonymous"></script>
<script src="/lib/sanitize-html-1.18.2.min.js"></script>

<script type="text/javascript">

var pageUrl = "https://blog.stephencleary.com" + "/2010/01/extension-based-types.html";

// (unnecessary) 1) If the URL starts with http://, replace with https://

// 2) Take the URL path (not including scheme and domain).
var url = document.createElement('a');
url.href = pageUrl; //'https://developer.mozilla.org:8080/en-US/search?q=URL#search-results-close-container';
var path = url.pathname;

// 3) Path: If the path ends with .html or any two- to six-character [A-Za-z0-9] extension, strip it.
if (path.endsWith(".html"))
    path = path.substr(0, path.length - 5);
else
    path = path.replace(/\.[A-Za-z0-9]{2,6}$/, "");

// 4) Path: For each UTF-16 code unit, if it's not in the whitelist [A-Za-z0-9-_;.~()], then replace it with _.
path = path.replace(/[^-A-Za-z0-9_;.~()]/g, "_");

// 5) Path: Trim leading and trailing _ characters.
path = path.replace(/^_+|_+$/g, "");

// 6) Calculate the V3 URL GUID for the URL.
var guid = uuidv3(pageUrl, uuidv3.URL);

// 7) Combine the path and lowercase-hyphenated GUID, separated by '-'.
var postId = path + "-" + guid;

var nofollowLinkExtension = {
    type: 'output',
    regex: /(<a[^<]+<\/a>)/g,
    replace: (match, $1, $2) => {
        var result = $('<div/>').append($($1).attr('rel', 'nofollow noopener')).html();
        return result;
    }
};
showdown.extension('nofollowLink', nofollowLinkExtension);

var comments;
var markdownConverter = new showdown.Converter({
    omitExtraWLInCodeBlocks: true,
    noHeaderId: true,
    headerLevelStart: 3,
    simplifiedAutoLink: true,
    excludeTrailingPunctuationFromURLs: true,
    literalMidWordUnderscores: true,
    strikethrough: true,
    smoothLivePreview: true,
    disableForced4SpacesIndentedSublists: true,
    extensions: ['nofollowLink']
});
var sanitizeOptions = {
    allowedTags: [ 'blockquote', 'p', 'a', 'ul', 'ol', 'nl', 'li', 'b', 'i', 'strong', 'em', 'strike', 'code', 'br', 'div', 'pre', 'img' ],
    allowedAttributes: {
        a: [
            'href',
            {
                name: 'rel',
                multiple: true,
                values: ['nofollow', 'noopener']
            }
        ],
        img: [ 'src' ]
    },
    allowedIframeHostnames: []
};

function fixedEncodeURIComponent(str) {
  return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
    return '%' + c.charCodeAt(0).toString(16);
  });
}

function filterComments(replyTo) {
    return comments
        .filter(function (x) { return x.replyTo === replyTo; })
        .sort(function (a, b) { return a.timestamp - b.timestamp; });
}

function avatarUri(comment) {
    if (comment.authorEmailMD5 === "")
        return "https://www.gravatar.com/avatar/?d=mp&f=y";
    else
        return "https://www.gravatar.com/avatar/" + comment.authorEmailMD5 + "?d=retro";
}

function commentId(id) { return "comment-" + id; }

var now = moment();
function $comment(comment) {
    var message = sanitizeHtml(markdownConverter.makeHtml(comment.message), sanitizeOptions);
    var $commentDiv = $('<div class="comment"/>');
    var publicationDate = moment(comment.date);
    var $author = $('<div class="comment-author"/>').append($('<span class="comment-author-name"/>').text(comment.authorName));
    if (comment.authorUri !== "")
        $author.append($('<span> • </span>'), $('<a class="comment-author-uri" rel="nofollow noopener"/>').attr('href', comment.authorUri).text(comment.authorUri));
    var $headerDiv = $('<div class="comment-header"/>').append(
        $('<div class="comment-author-profile" style="float:left;"/>').append($('<img class="comment-author-profile-image" src="' + avatarUri(comment) + '"/>')),
        $author,
        $('<div class="comment-date" />').append(
            $('<a/>').attr('href', '#' + commentId(comment._id)).attr('title', 'permalink').text(publicationDate.from(now) + ' (' + publicationDate.format('YYYY-MM-DD hh:mm:ss a') + ')')
        )
    );
    if (comment.replyTo !== "") {
        var parent = comments.filter(function (x) { return x._id === comment.replyTo })[0];
        $headerDiv.append($('<div/>').append($('<a/>').attr('href', '#' + commentId(comment.replyTo)).text('In reply to ' + parent.authorName)));
    }

    $commentDiv.append($('<div class="comment-anchor"/>').attr('id', commentId(comment._id)),
        $headerDiv,
        $('<div class="comment-message" style="clear:both;"/>').html(message)
    );

    var $commentContainer = $('<div class="comment-container"/>').append($commentDiv);
    var childComments = filterComments(comment._id);
    for (var i = 0; i != childComments.length; ++i) {
        var child = childComments[i];
        $commentContainer.append($comment(child));
    }

    return $commentContainer;
}

var req = new XMLHttpRequest();
req.addEventListener("load", function () {
    comments = JSON.parse(req.responseText);
    var commentCounter = document.getElementById('comment-counter');
    commentCounter.innerText = comments.length + " " + commentCounter.innerText;
    var $commentDiv = $('#comments');
    var toplevelComments = filterComments("");
    for (var i = 0; i != toplevelComments.length; ++i) {
        var comment = toplevelComments[i];
        $commentDiv.append($comment(comment));
    }
});
req.open('GET', "https://comments.stephencleary.com/" + postId + ".json");
req.send();
</script>

<!-- TODO-COMMENTS -->

<!-- Disqus variables -->
<!-- script type="text/javascript">
    var disqus_shortname = 'stephencleary';
    var disqus_identifier = "/2010/01/extension-based-types";
    var disqus_title = "Extension-Based Types";
    var disqus_url = "https://blog.stephencleary.com/2010/01/extension-based-types.html";
</script -->

<!-- Disqus comment counter -->
<!-- script type="text/javascript">
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
    }());
</script -->

<!-- Disqus comment section -->
<!-- script type="text/javascript">
    (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script -->



<!-- Google AdSense -->
<script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Moment -->
<script type="text/javascript">
    (function($) {
        $(function () {
            $('time').each(function (_, e) {
                var startOfToday = moment().startOf('day');
                var publicationDate = moment($(e).attr('datetime'), 'YYYY-MM-DD');
                var difference = startOfToday.diff(publicationDate, 'days');
                var text = difference === 0 ? 'Today' :
                    difference === 1 ? 'Yesterday' :
                    publicationDate.from(startOfToday);
                $(e).text(function(_, oldText) { return text + ' (' + oldText + ')'; });
            });
        });
    })(window.jQuery);
</script>




</body>
</html>