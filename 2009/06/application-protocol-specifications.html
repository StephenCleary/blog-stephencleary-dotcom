<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Application Protocol Specifications</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="When designing an application protocol, one should publish an application protocol specification document. Having a clearly-defined specification helps prevent errors on both sides." />
    <link rel="canonical" href="http://blog.stephencleary.com/2009/06/application-protocol-specifications.html" />
    
    <link rel="alternate" type="application/rss+xml" title="Stephen Cleary (the blog)" href="http://feeds.feedburner.com/NitoPrograms" />
    
    <link href="//netdna.bootstrapcdn.com/bootswatch/3.1.1/spacelab/bootstrap.min.css" rel="stylesheet" />
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="http://stephencleary.com/css/main.css" />
    <meta name="application-name" content="Stephen Cleary" />
    <link rel="apple-touch-icon" sizes="57x57" href="http://stephencleary.com/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://stephencleary.com/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://stephencleary.com/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="http://stephencleary.com/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="http://stephencleary.com/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="http://stephencleary.com/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="http://stephencleary.com/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="http://stephencleary.com/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" href="http://stephencleary.com/icons/apple-touch-icon.png"/>
    <link rel="apple-touch-icon-precomposed" href="http://stephencleary.com/icons/apple-touch-icon-precomposed.png"/>
    <link rel="icon" type="image/png" href="http://stephencleary.com/icons/favicon-196x196.png" sizes="196x196">
    <link rel="icon" type="image/png" href="http://stephencleary.com/icons/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="http://stephencleary.com/icons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="http://stephencleary.com/icons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="http://stephencleary.com/icons/favicon-32x32.png" sizes="32x32">
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <ul class="nav navbar-nav navbar-left">
                <li  ><a class="navbar-brand" href="http://stephencleary.com">Stephen Cleary</a></li>
            </ul>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-left">
                <li  class="active"  ><a href="http://blog.stephencleary.com">Blog</a></li>
                <li  ><a href="http://stephencleary.com/projects/">Projects</a></li>
                <li  ><a href="http://stephencleary.com/publications/">Publications</a></li>
                <li  ><a href="http://stephencleary.com/contact/">Contact</a></li>
                
                <li><a href="http://feeds.feedburner.com/NitoPrograms"><i class="fa fa-rss-square fa-lg"></i></a></li>
                
            </ul>
                    
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <form class="navbar-form google google-searchbox" role="search">
                        <gcse:searchbox></gcse:searchbox>
                    </form>
                </li>
            </ul>
        </div>
    </div>
</nav>


    <div class="container-fluid">
        <div class="col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3">
            <div class="post">

  <header>
      <div class="page-header">
          <h1>Application Protocol Specifications</h1>
          <small><time datetime="2009-06-30">Jun 30, 2009</time> &bull; <a data-disqus-identifier="/2009/06/application-protocol-specifications" href="#disqus_thread">Comments</a></small>
      </div>
  </header>

  <article>
  <p>When designing an application protocol, one should publish an application protocol specification document. Having a clearly-defined specification helps prevent errors on both sides.</p>

<h2 id="versioning">Versioning</h2>

<p>The application protocol specification document should include the protocol version number to which it applies. Protocols change over time as additional requirements are added.</p>

<p>There should also be a way for the protocol to perform some form of version negotiation. Usually, it is enough to have one side send a list of supported versions, and have the other side respond with the chosen version.</p>

<p>This is a bit of up-front work, but allows partial upgrades in the future without breaking backwards compatibility. When two separate vendors or teams are producing applications on different sides of the protocol, or if the protocol is an open specification, then version negotiation becomes much more important.</p>

<h2 id="terminology">Terminology</h2>

<p>The most important words in a specification are “must” and “may”. When used consistently, these terms convey specific meanings. “Must” is used when an implementation <em>absolutely</em> must obey the specification. “May” is used when an implementation <em>optionally</em> may obey the specification.</p>

<p>When possible, use long-established terminology. The key reference for this is <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>, which unambiguously defines MUST, MAY, SHOULD, etc. However, other standards often come into play; e.g., the Unicode standard has unambiguous definitions for “character”, “code point”, and “encoding”, which are important to distinguish when writing an unambiguous protocol specification. Any special terms should be identified in the document, along with a reference to the defining standard.</p>

<h2 id="server-and-client-first-contact">Server and Client: First Contact</h2>

<p>The first question that is often answered when writing a TCP/IP protocol is: who contacts whom? More specifically, one side must be chosen as the <em>server</em> and the other side as the <em>client</em>. In some cases, the choice of client and server sides is obvious. For other applications, it really doesn’t matter which side is chosen for which role. Very loosely coupled applications (following more of a peer-to-peer model) may even act as a client, server, or both (for the same protocol).</p>

<p>Note that <em>client</em> and <em>server</em> only have meaning when the connection is being established. Once the TCP/IP connection is established, it will allow either side to send data to the other side at any time.</p>

<p>Usually, it is the responsibility of the server side to accept any incoming connections at any time; and it is the responsibility of the client side to retry dropped connections after a timeout. This timeout may be specified in the application protocol document, or it may be left as an implementation detail.</p>

<h2 id="choosing-the-port">Choosing the Port</h2>

<p>The application protocol document should include the port number used for that protocol. Choosing a port number should be done with care; one must consider reserved port ranges as well as ephemeral port ranges. Ephemeral port ranges must be considered because any random client socket may be given a port in that range, and a server would be unable to bind on its port if that port was already being used by a client socket.</p>

<p>The <a href="http://www.iana.org/assignments/port-numbers">Internet Assigned Numbers Authority</a> has reserved ports 0-1023 for specific, well-known protocols. A port in this range should never be used unless it is registered with IANA.</p>

<p>IANA has also reserved ports 1024-49151 in a similar manner (requiring registration). However, most people ignore this, and treat the 1024-49151 port range as available except for their ephemeral port ranges.</p>

<p>Ephemeral port ranges are trickier, since <a href="http://en.wikipedia.org/wiki/Ephemeral_port">different operating systems use different ranges</a>. Windows systems use 1025 to 5000 by default, but the upper value <a href="http://technet.microsoft.com/en-us/library/bb878133.aspx">may be changed</a> via the registry.</p>

<p>In short, private Windows protocols (used only within a certain network) may pick a port from the range 5001-65535, with preference given to higher port numbers (so that individual machines may increase their MaxUserPort registry setting). If Linux compatibility is necessary, the range becomes 5001-32767 and 61001-65535, again prefering higher port numbers.</p>

<p>Public (published) protocols should be registered with IANA and use the assigned port in the 1024-49151 range. As of this writing, both Windows’ and Linux’s ephemeral port ranges overlap with this reserved range, so some extra action may need to be taken to prevent any possibility of conflicts (i.e., Windows’ ReservedPorts registry key; see <a href="http://support.microsoft.com/default.aspx/kb/812873">KB812873</a> or <a href="http://technet.microsoft.com/en-us/library/bb878133.aspx">The Cable Guy, Dec 2005</a>).</p>

<p>Note: It is highly recommended that the port be configurable by the end user or administrator. Currently, there are not many “well-behaved” programs when it comes to choosing ports, so it is greatly beneficial to give the network admin the ability to change the port.</p>

  </article>
    
    <footer>
        
            <ul class="pager">
                <li class="previous"><a href="/2009/05/detection-of-half-open-dropped.html" title="Detection of Half-Open (Dropped) Connections">&larr; Previous in TCP/IP .NET Sockets FAQ</a></li>
                <li class="next"><a href="/2009/07/xml-over-tcpip.html" title="XML over TCP/IP">Next in TCP/IP .NET Sockets FAQ &rarr;</a></li>
            </ul>
        
        
        <ul class="pager">
            <li class="previous"><a href="/2009/06/threadsafe-events.html" title="Threadsafe Events">&larr; Previous Post</a></li>
            <li class="next"><a href="/2009/07/xml-over-tcpip.html" title="XML over TCP/IP">Next Post &rarr;</a></li>
        </ul>

        <div id="disqus_thread"></div>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </footer>
</div>
        </div>
        <div class="col-sm-2 col-md-3 col-md-offset-0 col-lg-2 col-lg-offset-1 affix" data-spy="affix" role="navigation">
            
                <div class="panel panel-primary">
                    <div class="panel-heading">TCP/IP .NET Sockets FAQ</div>
                    <div class="panel-body sidenav">
                        <ul class="nav nav-pills nav-stacked">
                                                <li class="sidenavitem"><a href="/2009/04/tcpip-net-sockets-faq.html">Overview</a></li>
                                                <li class="sidenavitem"><a href="/2009/04/message-framing.html">Message Framing</a></li>
                                                <li class="sidenavitem"><a href="/2009/05/detection-of-half-open-dropped.html">Half-Open Connections</a></li>
                                                <li class="active sidenavitem"><a href="/2009/06/application-protocol-specifications.html">Application Protocol Specifications</a></li>
                                                <li class="sidenavitem"><a href="/2009/07/xml-over-tcpip.html">XML</a></li>
                                                <li class="sidenavitem"><a href="/2009/05/socket-operations.html">Socket Operations</a></li>
                                                <li class="sidenavitem"><a href="/2009/05/error-handling.html">Error Handling</a></li>
                                                <li class="sidenavitem"><a href="/2009/05/using-socket-as-client-socket.html">Client Sockets</a></li>
                                                <li class="sidenavitem"><a href="/2009/05/using-socket-as-server-listening-socket.html">Server Sockets</a></li>
                                                <li class="sidenavitem"><a href="/2009/06/using-socket-as-connected-socket.html">Connected Sockets</a></li>
                                                <li class="sidenavitem"><a href="/2009/05/tcpip-resources.html">Resources</a></li>
                                                <li class="sidenavitem"><a href="/2009/05/getting-local-ip-address.html">The Local IP Address</a></li>
                                                <li class="sidenavitem"><a href="/2009/04/sample-code-length-prefix-message.html">Length-Prefix Example</a></li>
                                                <li class="sidenavitem"><a href="/2009/05/getting-local-ip-addresses.html">Local IP Addresses Example</a></li>
                        </ul>
                    </div>
                </div>
            
        </div>
        <div class="col-sm-2 col-md-3 sidebar">
            <div class="panel panel-default">
                <div class="panel-heading">About Stephen Cleary</div>
                <div class="panel-body">
                    <div class="center"><img src="http://stephencleary.com/www.assets/Me-large.jpg"/></div>
                    <div class="center">Stephen Cleary is a <a href="http://www.landmarkbaptist.ws/salvation">Christian</a>, <a href="http://picasaweb.google.com/stephenandmandy">husband, father,</a> and programmer living in Northern Michigan.</div>
                    <div class="center"><a href="http://mvp.microsoft.com/en-us/mvp/Stephen%20Cleary-5000058"><img class="mvp-logo" src="http://stephencleary.com/www.assets/MVP.png"/></a></div>
                </div>
            </div>
            <div class="panel panel-primary">
                <div class="panel-heading">My book</div>
                <div class="panel-body center">
                    <div><a href="http://tinyurl.com/ConcurrencyCookbook"><img src="http://stephencleary.com/www.assets/Book-small.jpg"/></a></div>
                    <div>Available from <a href="http://tinyurl.com/ConcurrencyCookbook">O'Reilly</a> or <a href="http://tinyurl.com/ConcurrencyCookbookAmazon">Amazon</a>.</div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">Advertisement</div>
                <div class="panel-body">
                    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2749292939902134" data-ad-slot="7584809820" data-ad-format="auto"></ins>
                </div>
            </div>
            
            <div class="panel panel-primary">
                <div class="panel-heading">Popular Posts</div>
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li><a href="/2012/02/async-and-await.html">Async/await Intro</a></li>
                        <li><a href="/2013/11/there-is-no-thread.html">There Is No Thread</a></li>
                        <li><a href="/2012/07/dont-block-on-async-code.html">Don't Block on Async Code</a></li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">Series</div>
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li><a href="/2014/04/a-tour-of-task-part-0-overview.html">A Tour of Task</a></li>
                        <li><a href="/2013/10/taskrun-etiquette-and-proper-usage.html">Task.Run Etiquette</a></li>
                        <li><a href="/2013/05/taskrun-vs-backgroundworker-intro.html">Task.Run vs. BackgroundWorker</a></li>
                        <li><a href="/2013/01/async-oop-0-introduction.html">Async OOP</a></li>
                        <li><a href="/2009/04/tcpip-net-sockets-faq.html">TCP/IP .NET Sockets FAQ</a></li>
                        <li><a href="/2013/10/managed-services-roundup.html">Managed Services</a></li>
                        <li><a href="/2009/08/how-to-implement-idisposable-and.html">IDisposable and Finalizers</a></li>
                        <li><a href="/2011/02/option-parsing-introduction.html">Option Parsing</a></li>
                    </ul>
                </div>
            </div>
            
        </div>
    </div>

    <div class="google">
        <gcse:searchresults></gcse:searchresults>
    </div>
    
    <!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript">window.jQuery || document.write('<script src="/lib/jquery-2.1.1.min.js"><\/script>')</script>

<!-- Bootstrap -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script type="text/javascript">window.jQuery.fn.modal || document.write('<script src="/lib/bootstrap.min.js"><\/script>')</script>
<script type="text/javascript">
    (function($) {
        $(function() {
            if ($('body').css('color') !== 'rgb(102, 102, 102)') {
                $('head').prepend('<link rel="stylesheet" href="/lib/bootstrap.min.css" />');
            }
        });
    })(window.jQuery);
</script>

<!-- Font Awesome -->
<span id="facheck" class="fa" style="display:none"></span>
<script type="text/javascript">
    (function($) {
        $(function() {
            if ($('#facheck').css('fontFamily') !== 'FontAwesome') {
                $('head').prepend('<link rel="stylesheet" href="/lib/font-awesome.min.css" />');
            }
        });
    })(window.jQuery);
</script>

<!-- Scroll the sidebar into view (if necessary) -->

<script src="/lib/jquery.scrollTo.min.js"></script>
<script type="text/javascript">
    (function ($) {
        $(function () {
            var container = $('.affix').filter(function() { return $(this).css('position') == 'fixed'; });
            var target = container.find('.active');
            container.scrollTo(target, { offset: - (container.height() / 2 - target.height() / 2) });
        });
    })(window.jQuery);
</script>


<!-- Google analytics -->
<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-8910661-5', 'stephencleary.com');
    ga('send', 'pageview');
</script>

<!-- Google custom search -->
<script type="text/javascript">
    (function() {
        var cx = '012743255334612885637:mpmjhgx9bfg';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
    })();
</script>





<!-- Disqus comment counter -->
<script type="text/javascript">
    var disqus_shortname = 'stephencleary';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

<!-- Disqus comment section, lazy-loaded -->
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.4/waypoints.min.js"></script>
<script>window.jQuery.fn.waypoint || document.write('<script src="/lib/waypoints.min.js"><\/script>')</script>
<script type="text/javascript">
    var disqus_loaded = false;
    var disqus_identifier = "/2009/06/application-protocol-specifications";
    var disqus_title = "Application Protocol Specifications";
    var disqus_url = "http://blog.stephencleary.com/2009/06/application-protocol-specifications.html";
    (function($) {
        $(function() {
            $('.pager').waypoint({
                offset: 'bottom-in-view',
                handler: function() {
                    if (disqus_loaded)
                        return;
                    disqus_loaded = true;
                    var dsq = document.createElement('script');
                    dsq.type = 'text/javascript';
                    dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                }
            });
        });
    })(window.jQuery);
</script>



<!-- Google AdSense -->
<script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Moment -->
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.6.0/moment.min.js"></script>
<script type="text/javascript">window.moment || document.write('<script src="/lib/moment.min.js"><\/script>')</script>
<script type="text/javascript">
    (function($) {
        $(function() {
            $('time').each(function (_, e) {
                var text = moment($(e).attr('datetime'), 'YYYY-MM-DD').fromNow();
                $(e).text(function(_, oldText) { return text + ' (' + oldText + ')'; });
            });
        });
    })(window.jQuery);
</script>

</body>
</html>