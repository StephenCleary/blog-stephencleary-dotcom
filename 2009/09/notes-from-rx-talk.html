<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Notes from the Rx talk</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="As someone who does a lot of asynchronous programming on .NET, I had heard about the Rx (“reactive”) framework some time ago. The details online have been a little sketchy, so I finally took some time to watch Erik Meijer’s talk. Below are my notes and initial thoughts. I haven’t had time to play with the actual framework itself, but it’s something that is definitely coming to .NET eventually (it’s rumored to be in 4.0)." />
    <link rel="canonical" href="https://blog.stephencleary.com/2009/09/notes-from-rx-talk.html" />
    
    <link rel="alternate" type="application/rss+xml" title="Stephen Cleary (the blog)" href="http://feeds.feedburner.com/NitoPrograms" />
    
    <link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/bootswatch/3.2.0/spacelab/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" />
    <style type="text/css">/* Layout Styles */
/* ----------------------------------------------------------*/

body {
    padding-top: 50px;
}

.affix {
    top: 70px;
    bottom: 0;
    overflow-y: auto;
}

.navbar-brand {
    font-weight: bold;
}

.navbar-brand-container.active>a, .navbar-brand-container.active>a:hover, .navbar-brand-container.active>a:focus {
    color: #3399f3;
    background-color: transparent;
}

.sidebar {
    margin-top: 20px;
}

.sidenavitem {
    height: auto;
}

.sidebar img {
    /* Responsive images */
    display: inline-block;
    height: auto;
    max-width: 100%;
}

@media(max-width:767px) {
    .affix {
        position: static;
    }
}

div .vertical-margins {
    margin-top: 10px;
    margin-bottom: 10px;
}

.page-header {
    margin-top: 20px;
}

.center {
    text-align: center;
}

.project-icon {
    height: 128px;
    width: 128px;
}

.list-group-item h2 {
    margin-top: 10px;
}

/* Fixes for Google Custom Search in a Bootstrap page */
/* ----------------------------------------------------------*/
.google, .google *, .google *:before, .google *:after {
    -webkit-box-sizing: content-box;
    -moz-box-sizing: content-box;
    box-sizing: content-box;
}

.google table {
    border-collapse: separate;
}

.gsc-input-box {
    height: auto !important;
}

/* Fixes for Amazon widget in Bootstrap page */
.amzn_wdgt * {
    -webkit-box-sizing: content-box;
    -moz-box-sizing: content-box;
    box-sizing: content-box;
}

/* Post styles */
/* ----------------------------------------------------------*/

code {
    background-color: #F2F3F9;
    color: inherit;
}

.post img {
    /* Responsive images */
    display: inline-block;
    height: auto;
    max-width: 100%;
}

.post .table {
    table-layout: fixed;
}

.post .table code {
    white-space: normal;
}

.post .yes {
    color: #008000;
}

.post .no {
    color: #FF0000;
}

/* Syntax highlighting styles */
/* ----------------------------------------------------------*/

.highlight  { background: #ffffff; }
.highlight .c { color: #008000 } /* Comment */
.highlight .k { color: #0000ff } /* Keyword */
.highlight .cm { color: #008000 } /* Comment.Multiline */
.highlight .cp { color: #0000ff } /* Comment.Preproc */
.highlight .c1 { color: #008000 } /* Comment.Single */
.highlight .cs { color: #008000 } /* Comment.Special */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gh { font-weight: bold } /* Generic.Heading */
.highlight .gp { font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { font-weight: bold } /* Generic.Subheading */
.highlight .kc { color: #0000ff } /* Keyword.Constant */
.highlight .kd { color: #0000ff } /* Keyword.Declaration */
.highlight .kn { color: #0000ff } /* Keyword.Namespace */
.highlight .kp { color: #0000ff } /* Keyword.Pseudo */
.highlight .kr { color: #0000ff } /* Keyword.Reserved */
.highlight .kt { color: #2b91af } /* Keyword.Type */
.highlight .s { color: #a31515 } /* Literal.String */
.highlight .nc { color: #2b91af } /* Name.Class */
.highlight .ow { color: #0000ff } /* Operator.Word */
.highlight .sb { color: #a31515 } /* Literal.String.Backtick */
.highlight .sc { color: #a31515 } /* Literal.String.Char */
.highlight .sd { color: #a31515 } /* Literal.String.Doc */
.highlight .s2 { color: #a31515 } /* Literal.String.Double */
.highlight .se { color: #a31515 } /* Literal.String.Escape */
.highlight .sh { color: #a31515 } /* Literal.String.Heredoc */
.highlight .si { color: #a31515 } /* Literal.String.Interpol */
.highlight .sx { color: #a31515 } /* Literal.String.Other */
.highlight .sr { color: #a31515 } /* Literal.String.Regex */
.highlight .s1 { color: #a31515 } /* Literal.String.Single */
.highlight .ss { color: #a31515 } /* Literal.String.Symbol */

/* Comments */
/* ----------------------------------------------------------*/

.comment-container {
    margin-top: 10px;
}

.comment-container > .comment-container {
    margin-left: 2em;
}

.comment-container > .comment-container > .comment-container > .comment-container > .comment-container {
    margin-left: 0;
}

/* Correct anchor links in comments (they are offset by the height of the fixed header) */
.comment-anchor {
    display: block;
    position: relative;
    top: -60px;
    visibility: hidden;
}

.comment-author-profile-image {
    height: 80px;
    width: 80px;
    margin-right: 10px;
}
</style>
    
    <meta name="application-name" content="Stephen Cleary" />
    <link rel="search" type="application/opensearchdescription+xml" href="https://stephencleary.com/opensearch.xml" title="Cleary Search">
    <link rel="apple-touch-icon" sizes="57x57" href="https://stephencleary.com/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://stephencleary.com/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://stephencleary.com/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://stephencleary.com/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://stephencleary.com/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://stephencleary.com/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://stephencleary.com/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://stephencleary.com/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" href="https://stephencleary.com/icons/apple-touch-icon.png"/>
    <link rel="apple-touch-icon-precomposed" href="https://stephencleary.com/icons/apple-touch-icon-precomposed.png"/>
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-196x196.png" sizes="196x196">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-32x32.png" sizes="32x32">
    
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <div class="navbar-brand-container"><a class="navbar-brand" href="https://stephencleary.com">Stephen Cleary</a></div>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
            <li  class="active"  ><a href="https://blog.stephencleary.com">Blog</a></li>
            <li ><a href="https://stephencleary.com/videos/">Videos</a></li>
            <li  ><a href="https://stephencleary.com/projects/">Projects</a></li>
            <li  ><a href="https://stephencleary.com/publications/">Publications</a></li>
            <li  ><a href="https://stephencleary.com/book/">Book</a></li>
            <li  ><a href="https://stephencleary.com/contact/">Contact</a></li>
            <li><a href="http://feeds.feedburner.com/NitoPrograms"><i class="fa fa-rss-square fa-lg"></i></a></li>
            <li  ><a href="https://stephencleary.com/search/"><i class="fa fa-search"></i></a></li>
        </ul>
    </div>
</nav>

    <div class="container-fluid">
        <div class="col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3">
            <div class="post">

  <header>
      <div class="page-header">
          <h1>Notes from the Rx talk</h1>
          <small><time datetime="2009-09-03">Sep 3, 2009</time> &bull; <a id="comment-counter" href="#comments">Comments</a></small>
      </div>
  </header>

  <article>
  <p>As someone who does a lot of asynchronous programming on .NET, I had heard about the Rx (“reactive”) framework some time ago. The details online have been a little sketchy, so I finally took some time to watch <a href="http://www.langnetsymposium.com/2009/talks/23-ErikMeijer-LiveLabsReactiveFramework.html">Erik Meijer’s talk</a>. Below are my notes and initial thoughts. I haven’t had time to play with the actual framework itself, but it’s something that is definitely coming to .NET eventually (it’s rumored to be in 4.0).</p>

<p>This talk is titled “Live Labs Reactive Framework”, given by Erik Meijer at the 2009 Lang.NET Symposium.</p>

<ul>
  <li>LINQ is derived from Haskell ideas.</li>
  <li>Reactive programming is where the program asks the environment for input. But not with blocking, like Console.ReadLine does.</li>
  <li>Enumerable: consumer pulls successive elements from the collection, with blocking.</li>
  <li>Observable: producer pushes successive elements from the collection.</li>
  <li>There is a mathematical duality between Enumerable and Observable, which allows theorems proven for one system to have a dual theorem in the other system.</li>
  <li>Consider Enumerable:</li>
</ul>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">interface</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="k">out</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">IEnumerator</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">GetEnumerator</span><span class="p">();</span> <span class="p">}</span>
<span class="k">interface</span> <span class="n">IEnumerator</span><span class="p">&lt;</span><span class="k">out</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">:</span> <span class="n">IDisposable</span> <span class="p">{</span> <span class="kt">bool</span> <span class="n">MoveNext</span><span class="p">();</span> <span class="n">T</span> <span class="n">Current</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span> <span class="cm">/* Implicit throw */</span> <span class="p">}</span></code></pre></figure>

<ul>
  <li>There are actually two interface concepts here (Enumerable and Disposable). For now, ignore Disposable.</li>
  <li>Swap arguments and results (mathematical duality):</li>
</ul>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">interface</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="k">in</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">IDisposable</span> <span class="n">Register</span><span class="p">(</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">o</span><span class="p">);</span> <span class="p">}</span>
<span class="k">interface</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="k">in</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">{</span> <span class="k">void</span> <span class="n">OnCompleted</span><span class="p">(</span><span class="kt">bool</span> <span class="n">done</span><span class="p">);</span> <span class="n">T</span> <span class="n">OnUpdate</span> <span class="p">{</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="k">void</span> <span class="n">OnError</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">);</span> <span class="p">}</span></code></pre></figure>

<ul>
  <li>A cleaner interface (getting rid of “bool done” by only calling “OnCompleted” when it’s true; changing OnUpdate to a method):</li>
</ul>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">interface</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="k">in</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">IDisposable</span> <span class="n">Attach</span><span class="p">(</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">o</span><span class="p">);</span> <span class="p">}</span>
<span class="k">interface</span> <span class="n">IObserver</span><span class="p">&lt;</span><span class="k">in</span> <span class="n">T</span><span class="p">&gt;</span> <span class="p">{</span> <span class="k">void</span> <span class="n">OnCompleted</span><span class="p">();</span> <span class="k">void</span> <span class="n">OnUpdate</span><span class="p">(</span><span class="n">T</span> <span class="k">value</span><span class="p">);</span> <span class="k">void</span> <span class="n">OnError</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">);</span> <span class="p">}</span></code></pre></figure>

<ul>
  <li>This makes the Iterator pattern (Enumerable) related to Subject Observer pattern (Observable).</li>
  <li>Java has Observable/Observer, but in non-generic and noisy interfaces.</li>
  <li>Since Enumerables are monads, Observables are monads. Since LINQ concepts work on monads, then there is a LINQ for Observables.</li>
  <li>(At this point, Erik skipped some slides; everything under this point is my own interpretation of those slides)</li>
  <li>Combinators include Select, Where, Flatten, and SelectMany (which is Select + Flatten). [Note: Enumerable LINQ also supports flattening through SelectMany].
    <ul>
      <li>Interactive SelectMany uses a nested foreach, which iterates each element of each sequence, moving on to the next sequence when it’s empty.</li>
      <li>Reactive SelectMany uses a parallel foreach, which iterates each element of any sequence as they are pushed.</li>
      <li>Additional combinators include:
        <ul>
          <li>Until (to “cancel” reactions for an event)</li>
          <li>TimeOut</li>
          <li>Zip (to perform a logical combination of two event sequences)</li>
          <li>Scan (?)</li>
          <li>Take, Drop - like TakeWhile/SkipWhile (?)</li>
          <li>Sample, Buffer</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>AJAX is all about responding to events and performing asynchronous computations; it’s ideal for Rx.</li>
  <li>Rx has bridges from .NET events into an Observable collection.</li>
  <li>A common bug is being dependent on the order of asynchronous completions.</li>
  <li>Preemption operator (“.Until”) to listen for an event until there’s another situation (like another async computation being started, so the results of the previous computation should be ignored).</li>
  <li>The let operator (“.Let”) avoids undesired side effects (similar to a local variable).
    <ul>
      <li>Lazy evaluation with Observable makes this difficult.</li>
    </ul>
  </li>
  <li>Comega join patterns (zips) and parser combinators can also be supported.
    <ul>
      <li>Zip enables logic such as “(an A event and B event were pushed) or (a B event and C event were pushed)” to be treated as its own event stream.</li>
    </ul>
  </li>
  <li>Related work:
    <ul>
      <li>F# first-class events</li>
      <li>F# async workflows</li>
      <li>Thomasp Reactive LINQ</li>
      <li>Esterelle, Lustre</li>
      <li>Functional reactive programming</li>
      <li>Using iterators for async</li>
      <li>PowerShell, SSIS, WWF</li>
    </ul>
  </li>
  <li>Rx is a way of composing delimited continuations: see paper “Delimited continuations in Operating Systems”.</li>
  <li>
    <p>(At this point, Erik skipped some more slides; everything under this point is my own interpretation of those slides)</p>

    <ul>
      <li>C# pseudocode (using object expressions / anonymous inner classes) to convert a C# event to an Observable:</li>
    </ul>
  </li>
</ul>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">Control</span> <span class="p">{</span> <span class="k">event</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">KeyUp</span><span class="p">;</span> <span class="p">}</span>
<span class="n">IObservable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">GetKeyUp</span><span class="p">(</span><span class="k">this</span> <span class="n">Control</span> <span class="n">w</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">IObservible</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
  <span class="p">{</span>
    <span class="n">IDisposable</span> <span class="nf">Attach</span><span class="p">(</span><span class="n">IObserver</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">h</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">d</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">h</span><span class="p">.</span><span class="n">Yield</span><span class="p">);</span> <span class="c1">// Create delegate to call observer</span>
      <span class="n">w</span><span class="p">.</span><span class="n">KeyUp</span> <span class="p">+=</span> <span class="n">d</span><span class="p">;</span> <span class="c1">// Attach observer to event directly</span>
      <span class="k">return</span> <span class="k">new</span> <span class="n">IDisposable</span>
      <span class="p">{</span>
        <span class="k">void</span> <span class="nf">Dispose</span><span class="p">()</span> <span class="p">{</span> <span class="n">w</span><span class="p">.</span><span class="n">KeyUp</span> <span class="p">-=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// Disconnect on dispose</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span></code></pre></figure>

<ul>
  <li>Two IObservable<T> extension methods exist for attaching delegates:</T></li>
</ul>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">static</span> <span class="n">IDisposable</span> <span class="n">Attach</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">src</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="k">yield</span><span class="p">);</span>
<span class="k">static</span> <span class="n">IDisposable</span> <span class="n">Attach</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">IObservable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">src</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="k">yield</span><span class="p">,</span> <span class="n">Action</span><span class="p">&lt;</span><span class="n">Exception</span><span class="p">&gt;</span> <span class="k">throw</span><span class="p">);</span></code></pre></figure>

<ul>
  <li>The original style of event subscription treats the handler as a first-class object:</li>
</ul>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">Action</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">handler</span> <span class="p">=</span> <span class="p">...;</span>
<span class="n">txtbox</span><span class="p">.</span><span class="n">KeyUp</span> <span class="p">+=</span> <span class="n">handler</span><span class="p">;</span>
<span class="n">txtbox</span><span class="p">.</span><span class="n">KeyUp</span> <span class="p">-=</span> <span class="n">handler</span><span class="p">;</span></code></pre></figure>

<ul>
  <li>The Observable style of event subscription treats the event as a first-class object:</li>
</ul>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">keyup</span> <span class="p">=</span> <span class="n">txtbox</span><span class="p">.</span><span class="n">GetKeyUp</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">detacher</span> <span class="p">=</span> <span class="n">keyup</span><span class="p">.</span><span class="n">Attach</span><span class="p">(...);</span>
<span class="n">detacher</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span></code></pre></figure>

<ul>
  <li>Observable event collections when used with combinators allow implicit state variables. e.g., consider a “drag &amp; drop”:</li>
</ul>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">W</span> <span class="p">=</span> <span class="p">...</span> <span class="n">control</span> <span class="n">to</span> <span class="n">be</span> <span class="n">dragged</span> <span class="p">...;</span>
 
<span class="c1">// Set up mouse down/up detector</span>
<span class="kt">var</span> <span class="n">mouseDowns</span> <span class="p">=</span> <span class="k">from</span> <span class="n">md</span> <span class="k">in</span> <span class="n">W</span><span class="p">.</span><span class="n">GetMouseDown</span><span class="p">()</span> <span class="k">select</span> <span class="k">true</span><span class="p">;</span> <span class="c1">// Pushes &quot;true&quot; every time the mouse button goes down</span>
<span class="kt">var</span> <span class="n">mouseUps</span> <span class="p">=</span> <span class="k">from</span> <span class="n">md</span> <span class="k">in</span> <span class="n">W</span><span class="p">.</span><span class="n">GetMouseUp</span><span class="p">()</span> <span class="k">select</span> <span class="k">false</span><span class="p">;</span> <span class="c1">// Pushes &quot;false&quot; every time the mouse button goes up</span>
<span class="kt">var</span> <span class="n">mouseClicks</span> <span class="p">=</span> <span class="n">mouseDowns</span><span class="p">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">mouseUps</span><span class="p">);</span> <span class="c1">// A simple combination; pushes &quot;true&quot; when down, &quot;false&quot; when up</span>
 
<span class="c1">// Set up mouse movement detector and measurer</span>
<span class="kt">var</span> <span class="n">mouseMoves</span> <span class="p">=</span> <span class="k">from</span> <span class="n">mm</span> <span class="k">in</span> <span class="n">W</span><span class="p">.</span><span class="n">GetMouseMove</span><span class="p">()</span> <span class="k">select</span> <span class="k">new</span> <span class="p">{</span> <span class="n">mm</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">mm</span><span class="p">.</span><span class="n">Y</span> <span class="p">};</span> <span class="c1">// Pushes the X,Y location of the mouse every time it moves</span>
<span class="c1">// (This next line has a bug)</span>
<span class="kt">var</span> <span class="n">mouseDiffs</span> <span class="p">=</span> <span class="k">from</span> <span class="n">diff</span> <span class="k">in</span> <span class="n">mouseMoves</span><span class="p">.</span><span class="n">Skip</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="n">Zip</span><span class="p">(</span><span class="n">mouseMoves</span><span class="p">)</span> <span class="c1">// This part pushes the current and last location of the mouse every time it moves</span>
                 <span class="k">select</span> <span class="k">new</span> <span class="p">{</span> <span class="n">dX</span> <span class="p">=</span> <span class="n">diff</span><span class="p">.</span><span class="n">First</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="n">diff</span><span class="p">.</span><span class="n">Second</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
                              <span class="n">dY</span> <span class="p">=</span> <span class="n">diff</span><span class="p">.</span><span class="n">First</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="n">diff</span><span class="p">.</span><span class="n">Second</span><span class="p">.</span><span class="n">Y</span> <span class="p">};</span> <span class="c1">// Pushes the difference in location each time the mouse moves</span>
 
<span class="c1">// Set up mouse drag &amp; drop detector</span>
<span class="kt">var</span> <span class="n">mouseDrag</span> <span class="p">=</span> <span class="k">from</span> <span class="n">mousedown</span> <span class="k">in</span> <span class="n">mouseClicks</span>
                <span class="k">from</span> <span class="n">delta</span> <span class="k">in</span> <span class="n">mouseDiffs</span> <span class="k">where</span> <span class="n">leftdown</span>
                <span class="k">select</span> <span class="n">delta</span><span class="p">;</span> <span class="c1">// Pushes the difference in location each time the mouse moves while a button is down</span>
 
<span class="n">mouseDrag</span><span class="p">.</span><span class="n">Attach</span><span class="p">(</span><span class="n">delta</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="p">...</span> <span class="n">move</span> <span class="n">W</span> <span class="n">according</span> <span class="n">to</span> <span class="n">delta</span> <span class="p">...</span> <span class="p">});</span></code></pre></figure>

<ul>
  <li>You always need to be aware of side effects; use the Let operator to tame them:</li>
</ul>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">mouseDiffs</span> <span class="p">=</span> <span class="k">from</span> <span class="n">diff</span> <span class="k">in</span> <span class="n">mouseMoves</span><span class="p">.</span><span class="n">Skip</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="n">Zip</span><span class="p">(</span><span class="n">mouseMoves</span><span class="p">)</span> <span class="c1">// This part pushes the current and last location of the mouse every time it moves</span>
                 <span class="k">select</span> <span class="k">new</span> <span class="p">{</span> <span class="n">dX</span> <span class="p">=</span> <span class="n">diff</span><span class="p">.</span><span class="n">First</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="n">diff</span><span class="p">.</span><span class="n">Second</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
                              <span class="n">dY</span> <span class="p">=</span> <span class="n">diff</span><span class="p">.</span><span class="n">First</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="n">diff</span><span class="p">.</span><span class="n">Second</span><span class="p">.</span><span class="n">Y</span> <span class="p">};</span> <span class="c1">// Pushes the difference in location each time the mouse moves</span></code></pre></figure>

<p>should be:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">mouseDiffs</span> <span class="p">=</span> <span class="n">mouseMoves</span><span class="p">.</span><span class="n">Let</span><span class="p">(</span><span class="n">_mouseMoves</span> <span class="p">=&gt;</span> <span class="c1">// This part avoids side effects on mouseMoves</span>
                 <span class="k">from</span> <span class="n">diff</span> <span class="k">in</span> <span class="n">_mouseMoves</span><span class="p">.</span><span class="n">Skip</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="n">Zip</span><span class="p">(</span><span class="n">_mouseMoves</span><span class="p">)</span> <span class="c1">// This part pushes the current and last location of the mouse every time it moves</span>
                 <span class="k">select</span> <span class="k">new</span> <span class="p">{</span> <span class="n">dX</span> <span class="p">=</span> <span class="n">diff</span><span class="p">.</span><span class="n">First</span><span class="p">.</span><span class="n">X</span> <span class="p">-</span> <span class="n">diff</span><span class="p">.</span><span class="n">Second</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
                              <span class="n">dY</span> <span class="p">=</span> <span class="n">diff</span><span class="p">.</span><span class="n">First</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> <span class="n">diff</span><span class="p">.</span><span class="n">Second</span><span class="p">.</span><span class="n">Y</span> <span class="p">};</span> <span class="c1">// Pushes the difference in location each time the mouse moves</span></code></pre></figure>

<h2 id="my-thoughts">My thoughts</h2>

<p>Asynchronous programming has always been difficult. One of the hardest parts is the correct handling of “asynchronous state”, objects whose sole purpose in life is to track the state of input as events come in. I expect the Rx framework will really shine at removing the need for explicitly tracking state, especially noticeable in situations where keeping “asynchronous state” is complex.</p>

<p>The documentation will have to be good regarding side effects, so that programmers can more easily determine when Let/Until operators are required. Currently, I’m not aware of any documentation, even on the .NET 4.0 beta MSDN. This is just a preemptive warning: the docs will have to be really, really good; better than what was done for LINQ (where the docs are often unclear which operators cause buffering).</p>

<p>There is still a missing piece in the “pipeline story”. Historically, every language has gradually developed the same ideas: consumers, then producers, then a full pipeline. Push algorithms are usually the response to the “tee problem” in a pull-based framework. I did the same thing in C++ about 6 years ago, developing what I called “pipe algorithms”, named after the Unix pipe. Currently, we have Enumerable (pull) and Observable (push) models, but there are no easy translators between the two (these “translators” require dedicated threads).</p>

<p>It’s also important to note that one is not “better” than the other. Most algorithms are more naturally defined in an Enumerable model, so that is the one that is more intuitive. Other algorithms are a more natural fit to the Observable model. Once we have translators back and forth between the two models, then we’ll have a more mature language.</p>

<p>One person stated that the Rx framework will remove the need for EBAP components. I have not yet been convinced of this; I see EBAP as still being a useful technique for synchronizing events. The synchronized events can then be used as input to an Rx query. In this sense, I see the EBAP and Rx approaches as complementing each other.</p>


  </article>
    
    <footer class="hidden-print">
        
        
        <ul class="pager">
            <li class="previous"><a href="/2009/09/naming-unit-tests.html" title="Naming Unit Tests">&larr; Previous Post</a></li>
            <li class="next"><a href="/2009/09/70-536-in-bag.html" title="70-536 In the Bag">Next Post &rarr;</a></li>
        </ul>

        <div>Note: Comments are temporarily read-only. If you wish to make a comment, please email me directly.</div>
        <div id="comments"></div>
    </footer>
</div>
        </div>
        <div class="col-sm-2 col-md-3 col-md-offset-0 col-lg-2 col-lg-offset-1 affix hidden-print" data-spy="affix" role="navigation">
            
            
        </div>
        <div class="col-sm-2 sidebar hidden-print">
            <div class="panel panel-default">
                <div class="panel-heading">About Stephen Cleary</div>
                <div class="panel-body">
                    <div class="center"><img src="https://stephencleary.com/www.assets/Me-large.jpg"/></div>
                    <div class="center vertical-margins">Stephen Cleary is a <a href="https://stephencleary.com/god/">Christian</a>, husband, father, and programmer living in Northern Michigan.</div>
                    <div class="center"><a href="http://mvp.microsoft.com/en-us/mvp/Stephen%20Cleary-5000058"><img class="mvp-logo" src="https://stephencleary.com/www.assets/MVP.png"/></a></div>
                </div>
            </div>
            <div class="panel panel-primary">
                <div class="panel-heading">My book</div>
                <div class="panel-body center">
                    <div><a href="https://stephencleary.com/book/"><img src="https://stephencleary.com/www.assets/Book-small.jpg"/></a></div>
                    <div>Available from <a href="http://tinyurl.com/ConcurrencyCookbook">O'Reilly</a> or <a href="http://tinyurl.com/ConcurrencyCookbookAmazon">Amazon</a>.</div>
                    <div data-hide-after="2015-09-18 05-0700" class="hidden"><b><a href="http://tinyurl.com/ConcurrencyCookbook">Ebook is 50% off right now at O'Reilly</a> - use discount code <i>B2S5</i></b></div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">Advertisement</div>
                <div class="panel-body">
                    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2749292939902134" data-ad-slot="7584809820" data-ad-format="auto"></ins>
                </div>
            </div>
            
            <div class="panel panel-primary">
                <div class="panel-heading">Popular Posts</div>
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li><a href="/2012/02/async-and-await.html">Async/await Intro</a></li>
                        <li><a href="/2013/11/there-is-no-thread.html">There Is No Thread</a></li>
                        <li><a href="/2012/07/dont-block-on-async-code.html">Don't Block on Async Code</a></li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">Series</div>
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li><a href="/2016/02/react-redux-todomvc.html">React/Redux TodoMVC</a></li>
                        <li><a href="/2014/04/a-tour-of-task-part-0-overview.html">A Tour of Task</a></li>
                        <li><a href="/2013/10/taskrun-etiquette-and-proper-usage.html">Task.Run Etiquette</a></li>
                        <li><a href="/2013/05/taskrun-vs-backgroundworker-intro.html">Task.Run vs. BackgroundWorker</a></li>
                        <li><a href="/2013/01/async-oop-0-introduction.html">Async OOP</a></li>
                        <li><a href="/2009/04/tcpip-net-sockets-faq.html">TCP/IP .NET Sockets FAQ</a></li>
                        <li><a href="/2013/10/managed-services-roundup.html">Managed Services</a></li>
                        <li><a href="/2009/08/how-to-implement-idisposable-and.html">IDisposable and Finalizers</a></li>
                        <li><a href="/2011/02/option-parsing-introduction.html">Option Parsing</a></li>
                    </ul>
                </div>
            </div>
            
        </div>
    </div>

    <div class="google">
        <gcse:searchresults></gcse:searchresults>
    </div>
    
    <!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript">window.jQuery || document.write('<script src="/lib/jquery-2.1.1.min.js"><\/script>')</script>

<!-- Bootstrap -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script type="text/javascript">window.jQuery.fn.modal || document.write('<script src="/lib/bootstrap.min.js"><\/script>')</script>
<script type="text/javascript">
    (function($) {
        $(function() {
            if ($('body').css('color') !== 'rgb(102, 102, 102)') {
                $('head').prepend('<link rel="stylesheet" href="/lib/bootstrap.min.css" />');
            }
        });
    })(window.jQuery);
</script>

<!-- Font Awesome -->
<span id="facheck" class="fa" style="display:none"></span>
<script type="text/javascript">
    (function($) {
        $(function() {
            if ($('#facheck').css('fontFamily') !== 'FontAwesome') {
                $('head').prepend('<link rel="stylesheet" href="/lib/font-awesome.min.css" />');
            }
        });
    })(window.jQuery);
</script>

<!-- Scroll the sidebar into view (if necessary) -->


<!-- Moment -->
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.6.0/moment.min.js"></script>
<script type="text/javascript">window.moment || document.write('<script src="/lib/moment.min.js"><\/script>')</script>

<!-- Google analytics -->
<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-8910661-5', 'stephencleary.com');
    ga('send', 'pageview');
</script>

<!-- Show appropriate elements based on time -->
<script type="text/javascript">
    (function ($) {
        $(function () {
            var targets = $('[data-hide-after]');
            targets.each(function () {
                var $item = $(this);
                if (moment() < moment($item.attr('data-hide-after'))) {
                    $item.removeClass('hidden');
                }
            });
        });
    })(window.jQuery);
</script>








<script src="/lib/uuid-v3-3.2.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/showdown@1.8.6/dist/showdown.min.js" integrity="sha256-dwhppIrxD8qC6lNulndZgtIm4XBU9zoMd9OUoXzIDAE=" crossorigin="anonymous"></script>
<script src="/lib/sanitize-html-1.18.2.min.js"></script>

<script type="text/javascript">

var pageUrl = "https://blog.stephencleary.com" + "/2009/09/notes-from-rx-talk.html";

// (unnecessary) 1) If the URL starts with http://, replace with https://

// 2) Take the URL path (not including scheme and domain).
var url = document.createElement('a');
url.href = pageUrl; //'https://developer.mozilla.org:8080/en-US/search?q=URL#search-results-close-container';
var path = url.pathname;

// 3) Path: If the path ends with .html or any two- to six-character [A-Za-z0-9] extension, strip it.
if (path.endsWith(".html"))
    path = path.substr(0, path.length - 5);
else
    path = path.replace(/\.[A-Za-z0-9]{2,6}$/, "");

// 4) Path: For each UTF-16 code unit, if it's not in the whitelist [A-Za-z0-9-_;.~()], then replace it with _.
path = path.replace(/[^-A-Za-z0-9_;.~()]/g, "_");

// 5) Path: Trim leading and trailing _ characters.
path = path.replace(/^_+|_+$/g, "");

// 6) Calculate the V3 URL GUID for the URL.
var guid = uuidv3(pageUrl, uuidv3.URL);

// 7) Combine the path and lowercase-hyphenated GUID, separated by '-'.
var postId = path + "-" + guid;

var nofollowLinkExtension = {
    type: 'output',
    regex: /(<a[^<]+<\/a>)/g,
    replace: (match, $1, $2) => {
        var result = $('<div/>').append($($1).attr('rel', 'nofollow noopener')).html();
        return result;
    }
};
showdown.extension('nofollowLink', nofollowLinkExtension);

var comments;
var markdownConverter = new showdown.Converter({
    omitExtraWLInCodeBlocks: true,
    noHeaderId: true,
    headerLevelStart: 3,
    simplifiedAutoLink: true,
    excludeTrailingPunctuationFromURLs: true,
    literalMidWordUnderscores: true,
    strikethrough: true,
    smoothLivePreview: true,
    disableForced4SpacesIndentedSublists: true,
    extensions: ['nofollowLink']
});
var sanitizeOptions = {
    allowedTags: [ 'blockquote', 'p', 'a', 'ul', 'ol', 'nl', 'li', 'b', 'i', 'strong', 'em', 'strike', 'code', 'br', 'div', 'pre', 'img' ],
    allowedAttributes: {
        a: [
            'href',
            {
                name: 'rel',
                multiple: true,
                values: ['nofollow', 'noopener']
            }
        ],
        img: [ 'src' ]
    },
    allowedIframeHostnames: []
};

function fixedEncodeURIComponent(str) {
  return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
    return '%' + c.charCodeAt(0).toString(16);
  });
}

function filterComments(replyTo) {
    return comments
        .filter(function (x) { return x.replyTo === replyTo; })
        .sort(function (a, b) { return a.timestamp - b.timestamp; });
}

function avatarUri(comment) {
    if (comment.authorEmailMD5 === "")
        return "https://www.gravatar.com/avatar/?d=mp&f=y";
    else
        return "https://www.gravatar.com/avatar/" + comment.authorEmailMD5 + "?d=retro";
}

function commentId(id) { return "comment-" + id; }

var now = moment();
function $comment(comment) {
    var message = sanitizeHtml(markdownConverter.makeHtml(comment.message), sanitizeOptions);
    var $commentDiv = $('<div class="comment"/>');
    var publicationDate = moment(comment.date);
    var $author = $('<div class="comment-author"/>').append($('<span class="comment-author-name"/>').text(comment.authorName));
    if (comment.authorUri !== "")
        $author.append($('<span> • </span>'), $('<a class="comment-author-uri" rel="nofollow noopener"/>').attr('href', comment.authorUri).text(comment.authorUri));
    var $headerDiv = $('<div class="comment-header"/>').append(
        $('<div class="comment-author-profile" style="float:left;"/>').append($('<img class="comment-author-profile-image" src="' + avatarUri(comment) + '"/>')),
        $author,
        $('<div class="comment-date" />').append(
            $('<a/>').attr('href', '#' + commentId(comment._id)).attr('title', 'permalink').text(publicationDate.from(now) + ' (' + publicationDate.format('YYYY-MM-DD hh:mm:ss a') + ')')
        )
    );
    if (comment.replyTo !== "") {
        var parent = comments.filter(function (x) { return x._id === comment.replyTo })[0];
        $headerDiv.append($('<div/>').append($('<a/>').attr('href', '#' + commentId(comment.replyTo)).text('In reply to ' + parent.authorName)));
    }

    $commentDiv.append($('<div class="comment-anchor"/>').attr('id', commentId(comment._id)),
        $headerDiv,
        $('<div class="comment-message" style="clear:both;"/>').html(message)
    );

    var $commentContainer = $('<div class="comment-container"/>').append($commentDiv);
    var childComments = filterComments(comment._id);
    for (var i = 0; i != childComments.length; ++i) {
        var child = childComments[i];
        $commentContainer.append($comment(child));
    }

    return $commentContainer;
}

var req = new XMLHttpRequest();
req.addEventListener("load", function () {
    comments = JSON.parse(req.responseText);
    var commentCounter = document.getElementById('comment-counter');
    commentCounter.innerText = comments.length + " " + commentCounter.innerText;
    var $commentDiv = $('#comments');
    var toplevelComments = filterComments("");
    for (var i = 0; i != toplevelComments.length; ++i) {
        var comment = toplevelComments[i];
        $commentDiv.append($comment(comment));
    }
});
req.open('GET', "https://comments.stephencleary.com/" + postId + ".json");
req.send();
</script>

<!-- TODO-COMMENTS -->

<!-- Disqus variables -->
<!-- script type="text/javascript">
    var disqus_shortname = 'stephencleary';
    var disqus_identifier = "/2009/09/notes-from-rx-talk";
    var disqus_title = "Notes from the Rx talk";
    var disqus_url = "https://blog.stephencleary.com/2009/09/notes-from-rx-talk.html";
</script -->

<!-- Disqus comment counter -->
<!-- script type="text/javascript">
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(s);
    }());
</script -->

<!-- Disqus comment section -->
<!-- script type="text/javascript">
    (function() {
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script -->



<!-- Google AdSense -->
<script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Moment -->
<script type="text/javascript">
    (function($) {
        $(function () {
            $('time').each(function (_, e) {
                var startOfToday = moment().startOf('day');
                var publicationDate = moment($(e).attr('datetime'), 'YYYY-MM-DD');
                var difference = startOfToday.diff(publicationDate, 'days');
                var text = difference === 0 ? 'Today' :
                    difference === 1 ? 'Yesterday' :
                    publicationDate.from(startOfToday);
                $(e).text(function(_, oldText) { return text + ' (' + oldText + ')'; });
            });
        });
    })(window.jQuery);
</script>




</body>
</html>