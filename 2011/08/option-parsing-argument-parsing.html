<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Option Parsing: Argument Parsing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="This is going to be an in-depth post on how argument parsing works in the Nito.KitchenSink.OptionParsing library, and a couple of ways the parsing can be modified." />
    <link rel="canonical" href="https://blog.stephencleary.com/2011/08/option-parsing-argument-parsing.html" />
    
    <link rel="alternate" type="application/rss+xml" title="Stephen Cleary (the blog)" href="http://feeds.feedburner.com/NitoPrograms" />
    
    <link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/bootswatch/3.2.0/spacelab/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" />
    <style type="text/css">/* Layout Styles */
/* ----------------------------------------------------------*/

body {
    padding-top: 50px;
}

.affix {
    top: 70px;
    bottom: 0;
    overflow-y: auto;
}

.navbar-brand {
    font-weight: bold;
}

.navbar-brand-container.active>a, .navbar-brand-container.active>a:hover, .navbar-brand-container.active>a:focus {
    color: #3399f3;
    background-color: transparent;
}

.sidebar {
    margin-top: 20px;
}

.sidenavitem {
    height: auto;
}

.sidebar img {
    /* Responsive images */
    display: inline-block;
    height: auto;
    max-width: 100%;
}

@media(max-width:767px) {
    .affix {
        position: static;
    }
}

div .vertical-margins {
    margin-top: 10px;
    margin-bottom: 10px;
}

.page-header {
    margin-top: 20px;
}

.center {
    text-align: center;
}

.project-icon {
    height: 128px;
    width: 128px;
}

.list-group-item h2 {
    margin-top: 10px;
}

/* Fixes for Google Custom Search in a Bootstrap page */
/* ----------------------------------------------------------*/
.google, .google *, .google *:before, .google *:after {
    -webkit-box-sizing: content-box;
    -moz-box-sizing: content-box;
    box-sizing: content-box;
}

.google table {
    border-collapse: separate;
}

.gsc-input-box {
    height: auto !important;
}

/* Fixes for Amazon widget in Bootstrap page */
.amzn_wdgt * {
    -webkit-box-sizing: content-box;
    -moz-box-sizing: content-box;
    box-sizing: content-box;
}

/* Post styles */
/* ----------------------------------------------------------*/

code {
    background-color: #F2F3F9;
    color: inherit;
}

.post img {
    /* Responsive images */
    display: inline-block;
    height: auto;
    max-width: 100%;
}

.post .table {
    table-layout: fixed;
}

.post .table code {
    white-space: normal;
}

.post .yes {
    color: #008000;
}

.post .no {
    color: #FF0000;
}

/* Syntax highlighting styles */
/* ----------------------------------------------------------*/

.highlight  { background: #ffffff; }
.highlight .c { color: #008000 } /* Comment */
.highlight .k { color: #0000ff } /* Keyword */
.highlight .cm { color: #008000 } /* Comment.Multiline */
.highlight .cp { color: #0000ff } /* Comment.Preproc */
.highlight .c1 { color: #008000 } /* Comment.Single */
.highlight .cs { color: #008000 } /* Comment.Special */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gh { font-weight: bold } /* Generic.Heading */
.highlight .gp { font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { font-weight: bold } /* Generic.Subheading */
.highlight .kc { color: #0000ff } /* Keyword.Constant */
.highlight .kd { color: #0000ff } /* Keyword.Declaration */
.highlight .kn { color: #0000ff } /* Keyword.Namespace */
.highlight .kp { color: #0000ff } /* Keyword.Pseudo */
.highlight .kr { color: #0000ff } /* Keyword.Reserved */
.highlight .kt { color: #2b91af } /* Keyword.Type */
.highlight .s { color: #a31515 } /* Literal.String */
.highlight .nc { color: #2b91af } /* Name.Class */
.highlight .ow { color: #0000ff } /* Operator.Word */
.highlight .sb { color: #a31515 } /* Literal.String.Backtick */
.highlight .sc { color: #a31515 } /* Literal.String.Char */
.highlight .sd { color: #a31515 } /* Literal.String.Doc */
.highlight .s2 { color: #a31515 } /* Literal.String.Double */
.highlight .se { color: #a31515 } /* Literal.String.Escape */
.highlight .sh { color: #a31515 } /* Literal.String.Heredoc */
.highlight .si { color: #a31515 } /* Literal.String.Interpol */
.highlight .sx { color: #a31515 } /* Literal.String.Other */
.highlight .sr { color: #a31515 } /* Literal.String.Regex */
.highlight .s1 { color: #a31515 } /* Literal.String.Single */
.highlight .ss { color: #a31515 } /* Literal.String.Symbol */

/* Comments */
/* ----------------------------------------------------------*/

.comment-container {
    margin-top: 1em;
}

.comment-container > .comment-container {
    margin-left: 2em;
}

.comment-container > .comment-container > .comment-container > .comment-container > .comment-container {
    margin-left: 0;
}

/* Correct anchor links in comments (they are offset by the height of the fixed header) */
.comment-anchor {
    display: block;
    position: relative;
    top: -60px;
    visibility: hidden;
}

img.comment-author-profile-image {
    height: 80px;
    width: 80px;
    margin-right: 10px;
}

.comment-message {
    overflow-x: auto;
}

.comment-form {
    border: 1px solid black;
    padding: 1em;
}

.comment-new {
    margin-top: 1em;
    margin-bottom: 1em;
}

.comment-new, .comment-reply {
    margin-left: 1em;
}

.comment-hidden {
    display: none;
}

.comment-form-buttonbar {
    margin-top: 1em;
}
</style>
    
    <meta name="application-name" content="Stephen Cleary" />
    <link rel="search" type="application/opensearchdescription+xml" href="https://stephencleary.com/opensearch.xml" title="Cleary Search">
    <link rel="apple-touch-icon" sizes="57x57" href="https://stephencleary.com/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://stephencleary.com/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://stephencleary.com/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://stephencleary.com/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="https://stephencleary.com/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://stephencleary.com/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://stephencleary.com/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://stephencleary.com/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" href="https://stephencleary.com/icons/apple-touch-icon.png"/>
    <link rel="apple-touch-icon-precomposed" href="https://stephencleary.com/icons/apple-touch-icon-precomposed.png"/>
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-196x196.png" sizes="196x196">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="https://stephencleary.com/icons/favicon-32x32.png" sizes="32x32">
    
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <div class="navbar-brand-container"><a class="navbar-brand" href="https://stephencleary.com">Stephen Cleary</a></div>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
            <li  class="active"  ><a href="https://blog.stephencleary.com">Blog</a></li>
            <li ><a href="https://stephencleary.com/videos/">Videos</a></li>
            <li  ><a href="https://stephencleary.com/projects/">Projects</a></li>
            <li  ><a href="https://stephencleary.com/publications/">Publications</a></li>
            <li  ><a href="https://stephencleary.com/book/">Book</a></li>
            <li  ><a href="https://stephencleary.com/contact/">Contact</a></li>
            <li><a href="http://feeds.feedburner.com/NitoPrograms"><i class="fa fa-rss-square fa-lg"></i></a></li>
            <li  ><a href="https://stephencleary.com/search/"><i class="fa fa-search"></i></a></li>
        </ul>
    </div>
</nav>

    <div class="container-fluid">
        <div class="col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3">
            <div class="post">

  <header>
      <div class="page-header">
          <h1>Option Parsing: Argument Parsing</h1>
          <small><time datetime="2011-08-11">Aug 11, 2011</time> &bull; <a id="comment-counter" href="#comments">Comments</a></small>
      </div>
  </header>

  <article>
  <p>This is going to be an in-depth post on how argument parsing works in the <a href="http://nuget.org/List/Packages/Nito.KitchenSink.OptionParsing">Nito.KitchenSink.OptionParsing library</a>, and a couple of ways the parsing can be modified.</p>

<h2 id="general-option-argument-parsing-rules">General Option Argument Parsing Rules</h2>

<p>First, a reminder about terminology; in this example, the “v” is the short option name, and the “3” is the option argument:</p>

<pre><code>&gt; CommandLineTest.exe -v 3
</code></pre>

<p>Also remember that an option argument may be <em>required</em> for an option, or it may be <em>optional</em>. If you need a refresher, read the earlier post <a href="/2011/07/option-parsing-options-with-optional.html">options with optional arguments</a>.</p>

<p>Required option arguments are allowed to begin with a dash (<strong>-</strong>) or forward-slash (<strong>/</strong>), but optional option arguments are not. To start an optional option argument with these characters, specify the argument using a full-colon (<strong>:</strong>) or equals sign (<strong>=</strong>).</p>

<p>Consider this example program, which just takes two string arguments, one required and one optional:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Options</span> <span class="p">:</span> <span class="n">OptionArgumentsBase</span>
  <span class="p">{</span>
<span class="na">    [Option(&quot;required&quot;, &#39;r&#39;)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">RequiredValue</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Option(&quot;optional&quot;, &#39;o&#39;, Argument = OptionArgument.Optional)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">OptionalValue</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="kt">int</span> <span class="nf">Main</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="n">OptionParser</span><span class="p">.</span><span class="n">Parse</span><span class="p">&lt;</span><span class="n">Options</span><span class="p">&gt;();</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">RequiredValue</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Required Value: &quot;</span> <span class="p">+</span> <span class="n">options</span><span class="p">.</span><span class="n">RequiredValue</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">OptionalValue</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Optional Value: &quot;</span> <span class="p">+</span> <span class="n">options</span><span class="p">.</span><span class="n">OptionalValue</span><span class="p">);</span>

      <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">OptionParsingException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<pre><code>&gt; CommandLineParsingTest.exe -r a -o b
Required Value: a
Optional Value: b

&gt; CommandLineParsingTest.exe -r /a -o b
Required Value: /a
Optional Value: b

&gt; CommandLineParsingTest.exe -r a -o /b
Unknown option  b  in parameter  /b

&gt; CommandLineParsingTest.exe -o "/b"
Unknown option  b  in parameter  /b

&gt; CommandLineParsingTest.exe -o:/b
Optional Value: /b

&gt; CommandLineParsingTest.exe -o=/b
Optional Value: /b
</code></pre>

<p>Note that placing the argument in double-quotes does <em>not</em> allow the argument to start with a dash or forward-slash.</p>

<p>Reminder: the command shell has its own set of reserved characters (<code>&amp;</code>, <code>|</code>, <code>(</code>, <code>)</code>, <code>&lt;</code>, <code>&gt;</code>, and <code>^</code>). These can be escaped using <code>^</code>, or they can be wrapped in double-quotes. Command shell escapes are described in more detail in the <a href="/2011/06/option-parsing-lexing.html">post on command-line lexing</a>.</p>

<h2 id="implementing-a-simple-argument-parser">Implementing a Simple Argument Parser</h2>

<p>Parsing an argument option is done in two steps. The first step is to parse that portion of the command line as a string, using the rules above. The second step is to parse the string into an instance of the corresponding property type on the option arguments class. Since the examples above used a property type of string, there was no processing during the second step.</p>

<div class="alert alert-info">
  <p><i class="fa fa-hand-o-right fa-2x pull-left"></i></p>

  <p>It is possible to use only a part of the <a href="/2011/06/option-parsing-option-parsing-pipeline.html" class="alert-link">option parsing pipeline</a> to get options and their arguments as strings. Pass a sequence of <strong>OptionDefinition</strong> instancess and a command line into the parser; the result is a sequence of <strong>Option</strong> instances (where each argument is typed as <strong>string</strong>). Details of these types will be covered in a future blog post.</p>
</div>

<p>The option parsing library uses a collection of “simple parsers” to convert from a string to a known type. By default, the simple parser collection understands how to parse <strong>bool</strong>; signed and unsigned 8-bit, 16-bit, 32-bit, and 64-bit integers; <strong>BigInteger</strong>; single and double-precision floating point; <strong>decimal</strong>; <strong>Guid</strong>; <strong>TimeSpan</strong>; <strong>DateTime</strong>; and <strong>DateTimeOffset</strong>. Strings, enumerations and nullable types are treated specially: strings are never parsed, enumerations use <strong>Enum.Parse</strong>, and nullable types are supported if their corresponding non-nullable types are supported. The built-in parsers all use the standard <strong>TryParse</strong> methods.</p>

<p>Say, for example, we wanted to accept an argument of type <a href="http://msdn.microsoft.com/en-us/library/system.numerics.complex.aspx">Complex</a>. The Complex type is not included in the default simple parser collection (in fact, it does not even have a Parse or TryParse method!).</p>

<p>If we try to add it to our program, then whatever we pass as the argument value will just fail to parse:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Options</span> <span class="p">:</span> <span class="n">OptionArgumentsBase</span>
  <span class="p">{</span>
<span class="na">    [Option(&quot;value&quot;, &#39;v&#39;)]</span>
    <span class="k">public</span> <span class="n">Complex</span><span class="p">?</span> <span class="n">Value</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="kt">int</span> <span class="nf">Main</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="n">OptionParser</span><span class="p">.</span><span class="n">Parse</span><span class="p">&lt;</span><span class="n">Options</span><span class="p">&gt;();</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Value</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Value: &quot;</span> <span class="p">+</span> <span class="n">options</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>

      <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">OptionParsingException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<pre><code>&gt; CommandLineParsingTest.exe -v (3,5)
Could not parse  (3,5)  as Complex
</code></pre>

<p>We can create a parser for the <strong>Complex</strong> type by implementing <strong>ISimpleParser</strong>. This interface only has two members: the type of the result and a <strong>TryParse</strong> method.</p>

<p>Once we’ve implemented our special parser, we need to pass it to the Parse method. To do this, we create a <strong>SimpleParserCollection</strong>, add our special parser, and pass the collection to the Parse method.</p>

<p>Our solution now looks like this:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">ComplexParser</span> <span class="p">:</span> <span class="n">ISimpleParser</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="n">Type</span> <span class="n">ResultType</span>
    <span class="p">{</span>
      <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">typeof</span><span class="p">(</span><span class="n">Complex</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">object</span> <span class="nf">TryParse</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">// Match the following pattern: &#39;(&#39; double &#39;,&#39; double &#39;)&#39;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">Length</span> <span class="p">&lt;</span> <span class="m">5</span> <span class="p">||</span> <span class="k">value</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">!=</span> <span class="sc">&#39;(&#39;</span> <span class="p">||</span> <span class="k">value</span><span class="p">[</span><span class="k">value</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="m">1</span><span class="p">]</span> <span class="p">!=</span> <span class="sc">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
      <span class="kt">var</span> <span class="n">components</span> <span class="p">=</span> <span class="k">value</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="k">value</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="m">2</span><span class="p">).</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">components</span><span class="p">.</span><span class="n">Length</span> <span class="p">!=</span> <span class="m">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
      <span class="kt">double</span> <span class="n">real</span><span class="p">,</span> <span class="n">imaginary</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(!</span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="k">out</span> <span class="n">real</span><span class="p">))</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(!</span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">components</span><span class="p">[</span><span class="m">1</span><span class="p">],</span> <span class="k">out</span> <span class="n">imaginary</span><span class="p">))</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nf">Complex</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imaginary</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Options</span> <span class="p">:</span> <span class="n">OptionArgumentsBase</span>
  <span class="p">{</span>
<span class="na">    [Option(&quot;value&quot;, &#39;v&#39;)]</span>
    <span class="k">public</span> <span class="n">Complex</span><span class="p">?</span> <span class="n">Value</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="kt">int</span> <span class="nf">Main</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">parsers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SimpleParserCollection</span><span class="p">();</span>
      <span class="n">parsers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">ComplexParser</span><span class="p">());</span>
      <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="n">OptionParser</span><span class="p">.</span><span class="n">Parse</span><span class="p">&lt;</span><span class="n">Options</span><span class="p">&gt;(</span><span class="n">parserCollection</span><span class="p">:</span> <span class="n">parsers</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Value</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Value: &quot;</span> <span class="p">+</span> <span class="n">options</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>

      <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">OptionParsingException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<pre><code>&gt; CommandLineParsingTest.exe -v (3,5)
Value: (3, 5)
</code></pre>

<p>We added a custom parser to the collection, and the option parsing library now understands how to parse a new type. We could add any number of <strong>Complex</strong> properties, and they would all use the new parser.</p>

<p>This is a powerful extension point, but what if we want to modify the way an extisting type is parsed?</p>

<h2 id="replacing-a-simple-argument-parser">Replacing a Simple Argument Parser</h2>

<p>The default parsers in a simple parser collection only use the basic <strong>TryParse</strong> methods, which may not be exactly what is needed. <strong>SimpleParserCollection.Add</strong> will actually <em>replace</em> the parser for a given type if there is already a parser for that type.</p>

<p>We’ll use <strong>uint</strong> for our example. We want to allow either decimal numbers or hexadecimal numbers prefixed by “0x”. <strong>System.UInt32.TryParse(string)</strong> does not accept hexadecimal numbers:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Options</span> <span class="p">:</span> <span class="n">OptionArgumentsBase</span>
  <span class="p">{</span>
<span class="na">    [Option(&quot;value&quot;, &#39;v&#39;)]</span>
    <span class="k">public</span> <span class="kt">uint?</span> <span class="n">Value</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="kt">int</span> <span class="nf">Main</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="n">OptionParser</span><span class="p">.</span><span class="n">Parse</span><span class="p">&lt;</span><span class="n">Options</span><span class="p">&gt;();</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Value</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Value: &quot;</span> <span class="p">+</span> <span class="n">options</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>

      <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">OptionParsingException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<pre><code>&gt; CommandLineParsingTest.exe -v 11
Value: 11

&gt; CommandLineParsingTest.exe -v 0x11
Could not parse  0x11  as UInt32
</code></pre>

<p>Just like the last example, we’ll implement our own parser, and we’ll add it to the parser collection (replacing the default parser).</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">UInt32HexParser</span> <span class="p">:</span> <span class="n">ISimpleParser</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="n">Type</span> <span class="n">ResultType</span>
    <span class="p">{</span>
      <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">uint</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">object</span> <span class="nf">TryParse</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">uint</span> <span class="n">ret</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="s">&quot;0x&quot;</span><span class="p">))</span>
      <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="kt">uint</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="m">2</span><span class="p">),</span> <span class="n">NumberStyles</span><span class="p">.</span><span class="n">AllowHexSpecifier</span><span class="p">,</span> <span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">,</span> <span class="k">out</span> <span class="n">ret</span><span class="p">))</span>
          <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(!</span><span class="kt">uint</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="k">value</span><span class="p">,</span> <span class="k">out</span> <span class="n">ret</span><span class="p">))</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Options</span> <span class="p">:</span> <span class="n">OptionArgumentsBase</span>
  <span class="p">{</span>
<span class="na">    [Option(&quot;value&quot;, &#39;v&#39;)]</span>
    <span class="k">public</span> <span class="kt">uint?</span> <span class="n">Value</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="kt">int</span> <span class="nf">Main</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">parsers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SimpleParserCollection</span><span class="p">();</span>
      <span class="n">parsers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">UInt32HexParser</span><span class="p">());</span>
      <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="n">OptionParser</span><span class="p">.</span><span class="n">Parse</span><span class="p">&lt;</span><span class="n">Options</span><span class="p">&gt;(</span><span class="n">parserCollection</span><span class="p">:</span> <span class="n">parsers</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Value</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Value: &quot;</span> <span class="p">+</span> <span class="n">options</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>

      <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">OptionParsingException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<pre><code>&gt; CommandLineParsingTest.exe -v 11
Value: 11

&gt; CommandLineParsingTest.exe -v 0x11
Value: 17
</code></pre>

<p>Our program now allows decimal or hexadecimal values for all <strong>uint</strong> argument values.</p>

<p>These custom parsers can be written for any type, including types specific for your program. The only type they won’t work on is string, since the simple parser collection just passes string values straight through.</p>

<h2 id="overriding-the-simple-argument-parser">Overriding the Simple Argument Parser</h2>

<p>The examples so far have implemented a custom parser and added it to the parser collection. This changes the parsing behavior for <em>every</em> property of that type. Sometimes we just want to apply a parser to a single property; this can be done by using the <strong>SimpleParserAttribute</strong>.</p>

<p>This example defines a hex parser (without the “0x” prefix) and then uses it for only one of its properties:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">UInt32HexParser</span> <span class="p">:</span> <span class="n">ISimpleParser</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="n">Type</span> <span class="n">ResultType</span>
    <span class="p">{</span>
      <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">uint</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">object</span> <span class="nf">TryParse</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">uint</span> <span class="n">ret</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(!</span><span class="kt">uint</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="k">value</span><span class="p">,</span> <span class="n">NumberStyles</span><span class="p">.</span><span class="n">AllowHexSpecifier</span><span class="p">,</span> <span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">,</span> <span class="k">out</span> <span class="n">ret</span><span class="p">))</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Options</span> <span class="p">:</span> <span class="n">OptionArgumentsBase</span>
  <span class="p">{</span>
<span class="na">    [Option(&quot;hex-value&quot;, &#39;h&#39;)]</span>
<span class="na">    [SimpleParser(typeof(UInt32HexParser))]</span>
    <span class="k">public</span> <span class="kt">uint?</span> <span class="n">HexValue</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Option(&quot;dec-value&quot;, &#39;d&#39;)]</span>
    <span class="k">public</span> <span class="kt">uint?</span> <span class="n">DecValue</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="kt">int</span> <span class="nf">Main</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="n">OptionParser</span><span class="p">.</span><span class="n">Parse</span><span class="p">&lt;</span><span class="n">Options</span><span class="p">&gt;();</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">HexValue</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;HexValue: &quot;</span> <span class="p">+</span> <span class="n">options</span><span class="p">.</span><span class="n">HexValue</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">DecValue</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;DecValue: &quot;</span> <span class="p">+</span> <span class="n">options</span><span class="p">.</span><span class="n">DecValue</span><span class="p">);</span>

      <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">OptionParsingException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<pre><code>&gt; CommandLineParsingTest.exe -h 11 -d 11
HexValue: 17
DecValue: 11
</code></pre>

<h2 id="custom-parsers-for-multiple-argument-values">Custom Parsers for Multiple Argument Values</h2>

<p>Revisiting the problem of <a href="/2011/07/option-parsing-allowing-multiple.html">multiple argument values</a>, we can use a custom parser for a cleaner solution. This example “sequence parser” uses the default simple parser for <strong>int</strong> types, which is easier to deal with than <strong>int.TryParse</strong>:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Int32SequenceParser</span> <span class="p">:</span> <span class="n">ISimpleParser</span>
  <span class="p">{</span>
    <span class="k">public</span> <span class="n">Type</span> <span class="n">ResultType</span>
    <span class="p">{</span>
      <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">typeof</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;);</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">object</span> <span class="nf">TryParse</span><span class="p">(</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">values</span> <span class="p">=</span> <span class="k">value</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">&#39;,&#39;</span><span class="p">);</span>
      <span class="n">ISimpleParser</span> <span class="n">defaultParser</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DefaultSimpleParser</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
      <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">values</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">defaultParser</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span> <span class="p">==</span> <span class="k">null</span><span class="p">))</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">Cast</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">sealed</span> <span class="k">class</span> <span class="nc">Options</span> <span class="p">:</span> <span class="n">OptionArgumentsBase</span>
  <span class="p">{</span>
<span class="na">    [Option(&quot;values&quot;, &#39;v&#39;)]</span>
<span class="na">    [SimpleParser(typeof(Int32SequenceParser))]</span>
    <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">Values</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">static</span> <span class="kt">int</span> <span class="nf">Main</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
      <span class="kt">var</span> <span class="n">options</span> <span class="p">=</span> <span class="n">OptionParser</span><span class="p">.</span><span class="n">Parse</span><span class="p">&lt;</span><span class="n">Options</span><span class="p">&gt;();</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">options</span><span class="p">.</span><span class="n">Values</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">&quot;Values: &quot;</span> <span class="p">+</span> <span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="n">options</span><span class="p">.</span><span class="n">Values</span><span class="p">));</span>

      <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">OptionParsingException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Console</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span>
      <span class="k">return</span> <span class="m">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<pre><code>&gt; CommandLineParsingTest.exe

&gt; CommandLineParsingTest.exe -v 2,3,5,7
Values: 2 3 5 7

&gt; CommandLineParsingTest.exe -v 2,3a,5
Could not parse  2,3a,5  as IEnumerable&lt;Int32&gt;

&gt; CommandLineParsingTest.exe -v 2,3 -v 5,7
Values: 5 7
</code></pre>

<p>The last example above shows that the default behavior of the actual property setter is still <em>overwrite</em>, not <em>append</em>. If you want to allow appending sequences, you’ll need to change the setter to append each sequence to an internal collection.</p>


  </article>
    
    <footer class="hidden-print">
        
            <ul class="pager">
                <li class="previous"><a href="/2011/08/option-parsing-preventing-multiple.html" title="Option Parsing: Preventing Multiple Argument Values">&larr; Previous in Option Parsing</a></li>
                <li class="next"><a href="/2011/08/option-parsing-boolean-options.html" title="Option Parsing: Boolean Options">Next in Option Parsing &rarr;</a></li>
            </ul>
        
        
        <ul class="pager">
            <li class="previous"><a href="/2011/08/option-parsing-preventing-multiple.html" title="Option Parsing: Preventing Multiple Argument Values">&larr; Previous Post</a></li>
            <li class="next"><a href="/2011/08/option-parsing-boolean-options.html" title="Option Parsing: Boolean Options">Next Post &rarr;</a></li>
        </ul>

        <div id="comments"></div>
    </footer>
</div>
        </div>
        <div class="col-sm-2 col-md-3 col-md-offset-0 col-lg-2 col-lg-offset-1 affix hidden-print" data-spy="affix" role="navigation">
            
                <div class="panel panel-primary">
                    <div class="panel-heading">Option Parsing</div>
                    <div class="panel-body sidenav">
                        <ul class="nav nav-pills nav-stacked">
                                    <li class="sidenavitem"><a href="/2011/02/option-parsing-introduction.html">Introduction</a></li>
                                    <li class="sidenavitem"><a href="/2011/06/option-parsing-option-parsing-pipeline.html">The Option Parsing Pipeline</a></li>
                                    <li class="sidenavitem"><a href="/2011/06/option-parsing-lexing.html">Lexing</a></li>
                                    <li class="sidenavitem"><a href="/2011/06/option-parsing-error-handling.html">Error Handling</a></li>
                                    <li class="sidenavitem"><a href="/2011/06/option-parsing-option-names.html">Option Names</a></li>
                                    <li class="sidenavitem"><a href="/2011/07/option-parsing-default-and-nullable.html">Default and Nullable Argument Values</a></li>
                                    <li class="sidenavitem"><a href="/2011/07/option-parsing-options-with-optional.html">Options with Optional Arguments</a></li>
                                    <li class="sidenavitem"><a href="/2011/07/option-parsing-allowing-multiple.html">Allowing Multiple Argument Values</a></li>
                                    <li class="sidenavitem"><a href="/2011/08/option-parsing-preventing-multiple.html">Preventing Multiple Argument Values</a></li>
                                    <li class="active sidenavitem"><a href="/2011/08/option-parsing-argument-parsing.html">Argument Parsing</a></li>
                                    <li class="sidenavitem"><a href="/2011/08/option-parsing-boolean-options.html">Boolean Options</a></li>
                                    <li class="sidenavitem"><a href="/2011/08/option-parsing-validation.html">Validation</a></li>
                                    <li class="sidenavitem"><a href="/2011/10/option-parsing-positional-arguments.html">Positional Arguments</a></li>
                                    <li class="sidenavitem"><a href="/2011/10/option-parsing-case-sensitivity.html">Case Sensitivity</a></li>
                        </ul>
                    </div>
                </div>
            
        </div>
        <div class="col-sm-2 sidebar hidden-print">
            <div class="panel panel-default">
                <div class="panel-heading">About Stephen Cleary</div>
                <div class="panel-body">
                    <div class="center"><img src="https://stephencleary.com/www.assets/Me-large.jpg"/></div>
                    <div class="center vertical-margins">Stephen Cleary is a <a href="https://stephencleary.com/god/">Christian</a>, husband, father, and programmer living in Northern Michigan.</div>
                    <div class="center"><a href="http://mvp.microsoft.com/en-us/mvp/Stephen%20Cleary-5000058"><img class="mvp-logo" src="https://stephencleary.com/www.assets/MVP.png"/></a></div>
                </div>
            </div>
            <div class="panel panel-primary">
                <div class="panel-heading">My book</div>
                <div class="panel-body center">
                    <div><a href="https://stephencleary.com/book/"><img src="https://stephencleary.com/www.assets/Book-small.jpg"/></a></div>
                    <div>Available from <a href="http://tinyurl.com/ConcurrencyCookbook">O'Reilly (Safari)</a>, <a href="http://tinyurl.com/ConcurrencyCookbookAmazon">Amazon (print/Kindle)</a>, or <a href="https://tinyurl.com/ConcurrencyCookbookEbooks">eBooks.com (PDF/epub)</a>.</div>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">Advertisement</div>
                <div class="panel-body">
                    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2749292939902134" data-ad-slot="7584809820" data-ad-format="auto"></ins>
                </div>
            </div>
            
            <div class="panel panel-primary">
                <div class="panel-heading">Popular Posts</div>
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li><a href="/2012/02/async-and-await.html">Async/await Intro</a></li>
                        <li><a href="/2013/11/there-is-no-thread.html">There Is No Thread</a></li>
                        <li><a href="/2012/07/dont-block-on-async-code.html">Don't Block on Async Code</a></li>
                    </ul>
                </div>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">Series</div>
                <div class="panel-body">
                    <ul class="nav nav-pills nav-stacked">
                        <li><a href="/2016/02/react-redux-todomvc.html">React/Redux TodoMVC</a></li>
                        <li><a href="/2014/04/a-tour-of-task-part-0-overview.html">A Tour of Task</a></li>
                        <li><a href="/2013/10/taskrun-etiquette-and-proper-usage.html">Task.Run Etiquette</a></li>
                        <li><a href="/2013/05/taskrun-vs-backgroundworker-intro.html">Task.Run vs. BackgroundWorker</a></li>
                        <li><a href="/2013/01/async-oop-0-introduction.html">Async OOP</a></li>
                        <li><a href="/2009/04/tcpip-net-sockets-faq.html">TCP/IP .NET Sockets FAQ</a></li>
                        <li><a href="/2013/10/managed-services-roundup.html">Managed Services</a></li>
                        <li><a href="/2009/08/how-to-implement-idisposable-and.html">IDisposable and Finalizers</a></li>
                        <li><a href="/2011/02/option-parsing-introduction.html">Option Parsing</a></li>
                    </ul>
                </div>
            </div>
            
        </div>
    </div>

    <div class="google">
        <gcse:searchresults></gcse:searchresults>
    </div>
    
    <!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript">window.jQuery || document.write('<script src="/lib/jquery-2.1.1.min.js"><\/script>')</script>

<!-- Bootstrap -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script type="text/javascript">window.jQuery.fn.modal || document.write('<script src="/lib/bootstrap.min.js"><\/script>')</script>
<script type="text/javascript">
    (function($) {
        $(function() {
            if ($('body').css('color') !== 'rgb(102, 102, 102)') {
                $('head').prepend('<link rel="stylesheet" href="/lib/bootstrap.min.css" />');
            }
        });
    })(window.jQuery);
</script>

<!-- Font Awesome -->
<span id="facheck" class="fa" style="display:none"></span>
<script type="text/javascript">
    (function($) {
        $(function() {
            if ($('#facheck').css('fontFamily') !== 'FontAwesome') {
                $('head').prepend('<link rel="stylesheet" href="/lib/font-awesome.min.css" />');
            }
        });
    })(window.jQuery);
</script>

<!-- Scroll the sidebar into view (if necessary) -->

<script src="/lib/jquery.scrollTo.min.js"></script>
<script type="text/javascript">
    (function ($) {
        $(function () {
            var container = $('.affix').filter(function() { return $(this).css('position') == 'fixed'; });
            var target = container.find('.active');
            container.scrollTo(target, { offset: - (container.height() / 2 - target.height() / 2) });
        });
    })(window.jQuery);
</script>


<!-- Moment -->
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.6.0/moment.min.js"></script>
<script type="text/javascript">window.moment || document.write('<script src="/lib/moment.min.js"><\/script>')</script>

<!-- Google analytics -->
<script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-8910661-5', 'stephencleary.com');
    ga('send', 'pageview');
</script>

<!-- Show appropriate elements based on time -->
<script type="text/javascript">
    (function ($) {
        $(function () {
            var targets = $('[data-hide-after]');
            targets.each(function () {
                var $item = $(this);
                if (moment() < moment($item.attr('data-hide-after'))) {
                    $item.removeClass('hidden');
                }
            });
        });
    })(window.jQuery);
</script>








<script src="/lib/uuid-v3-3.2.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/showdown@1.8.6/dist/showdown.min.js" integrity="sha256-dwhppIrxD8qC6lNulndZgtIm4XBU9zoMd9OUoXzIDAE=" crossorigin="anonymous"></script>
<script src="/lib/sanitize-html-1.18.2.min.js"></script>
<script src="/lib/autosize.min.js"></script>
<script src="/lib/base64js.min.js"></script>
<script src="/lib/md5.min.js"></script>

<script type="text/javascript">

var pageUrl = "https://blog.stephencleary.com" + "/2011/08/option-parsing-argument-parsing.html";

// (unnecessary) 1) If the URL starts with http://, replace with https://

// 2) Take the URL path (not including scheme and domain).
var url = document.createElement('a');
url.href = pageUrl; //'https://developer.mozilla.org:8080/en-US/search?q=URL#search-results-close-container';
var path = url.pathname;

// 3) Path: If the path ends with .html or any two- to six-character [A-Za-z0-9] extension, strip it.
if (path.endsWith(".html"))
    path = path.substr(0, path.length - 5);
else
    path = path.replace(/\.[A-Za-z0-9]{2,6}$/, "");

// 4) Path: For each UTF-16 code unit, if it's not in the whitelist [A-Za-z0-9-_;.~()], then replace it with _.
path = path.replace(/[^-A-Za-z0-9_;.~()]/g, "_");

// 5) Path: Trim leading and trailing _ characters.
path = path.replace(/^_+|_+$/g, "");

// 6) Calculate the V3 URL GUID for the URL.
var guid = uuidv3(pageUrl, uuidv3.URL);

// 7) Combine the path and lowercase-hyphenated GUID, separated by '-'.
var postId = path + "-" + guid;

var nofollowLinkExtension = {
    type: 'output',
    regex: /(<a[^<]+<\/a>)/g,
    replace: (match, $1, $2) => {
        var result = $('<div/>').append($($1).attr('rel', 'nofollow noopener')).html();
        return result;
    }
};
showdown.extension('nofollowLink', nofollowLinkExtension);

var comments;
var markdownConverter = new showdown.Converter({
    omitExtraWLInCodeBlocks: true,
    noHeaderId: true,
    headerLevelStart: 3,
    simplifiedAutoLink: true,
    excludeTrailingPunctuationFromURLs: true,
    literalMidWordUnderscores: true,
    strikethrough: true,
    smoothLivePreview: true,
    disableForced4SpacesIndentedSublists: true,
    extensions: ['nofollowLink']
});
var sanitizeOptions = {
    allowedTags: [ 'blockquote', 'p', 'a', 'ul', 'ol', 'nl', 'li', 'b', 'i', 'strong', 'em', 'strike', 'code', 'br', 'div', 'pre', 'img' ],
    allowedAttributes: {
        a: [
            'href',
            {
                name: 'rel',
                multiple: true,
                values: ['nofollow', 'noopener']
            }
        ],
        img: [ 'src' ]
    },
    allowedIframeHostnames: []
};

function fixedEncodeURIComponent(str) {
  return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
    return '%' + c.charCodeAt(0).toString(16);
  });
}

function filterComments(replyTo) {
    return comments
        .filter(function (x) { return x.replyTo === replyTo; })
        .sort(function (a, b) { return a.timestamp - b.timestamp; });
}

function avatarUri(authorEmailMD5) {
    if (authorEmailMD5 === "")
        return "https://www.gravatar.com/avatar/?d=mp&f=y";
    else
        return "https://www.gravatar.com/avatar/" + authorEmailMD5 + "?d=retro";
}

var jwk = {"kty":"RSA","alg":"RSA-OAEP","n":"wviXqUJGtV8hZrvJMcTbyzm7MmiJSqsAfWI_7pCyAhXXzz5C9F3NtXp79CCUMqkOck6IbNKUntPtGNOGwtoc5LTJNKLhx3TPi4TJyKUSfNr3pAdLpMRNeeRXCHFyyVsDb6z8ueixlKzdbDpZhV05bam49PurMHfeexJ3EJy2NpdFviykRJxtrERi6ckBe96VMlT_pHHIWLN5EwOK54DvNn1DYjiFK5ux5WRCFatZByzytrFvIllZRctNXZ8oTuMjQwKLY2bUrURblbIvLfX-9Yd7uVgdUSFE7-vSel9-DMyp_NQ-NRXrQbJG7IAYhSGSx-TPepCDPbFpMq3yC0iET7wF7-OQOb-Kwej_TKVJv-z4SbN-cpCqaMr5Q9scyGih7xr1YrOhe3TMs_cbgjtxsZbzkOqcuRreON_sGb9nlDpSIFCo6aH47GeMkA23Hk3HXAPyYQ7AfWhU9daiPcySiAFnfkrg2QvFNJmMSZ-bo4Co-JkjiqKw-LEpOw6Ed9LK4walxWUAqPGcT4_Uys3TH9XVex9_rEmigHXiJY3_Lwi6mTSkW10-zen5UXxqnyHpMxlmumohT96OyLyhEPeaaq8FrTYMCX8TiMOst3jF5QCNP-LFz21yeUEAr5_3-FKV2mjWEU9iW0dOOVTII2rlD0WtCkqkDwZtakQ1ynGdW1E","e":"AQAB"};

function commentId(id) { return "comment-" + id; }

function $commentForm(hideForm, comment) {
    var $previewDiv = $('<div/>');
    var $authorEmailEncrypted = $('<input type="hidden" name="fields[authorEmailEncrypted]">');
    var $authorEmailMD5 = $('<input type="hidden" name="fields[authorEmailMD5]">');
    var $email = $('<input type="email" name="email" class="form-control" placeholder="Email">');
    var $name = $('<input type="text" name="fields[authorName]" class="form-control" placeholder="Name">');
    var $url = $('<input type="url" name="fields[authorUri]" class="form-control" placeholder="Url">');
    var $message = $('<textarea name="fields[message]" class="form-control" placeholder="Message"/></textarea>');
    autosize($message);
    var $replyTo = $('<input type="hidden" name="fields[replyTo]">').val("");
    var $recaptcha = $('<div class="g-recaptcha" data-sitekey="6LfSaV8UAAAAAEFq-7HeUDiSQCkCtLtO_yc_SOi_"></div>');
    var $buttonBar = $('<div class="comment-form-buttonbar"/>').append($('<button type="submit" class="btn btn-primary pull-right">Submit</button>'), $recaptcha);
    var $form = $('<form method="POST" action="https://api.staticman.net/v2/entry/StephenCleary/comments.stephencleary.com/master"/>')
        .append($('<input type="hidden" name="fields[postId]">').val(postId))
        .append($('<input type="hidden" name="fields[postUri]">').val(location.href.replace(/#.*/, '')))
        .append($('<input type="hidden" name="options[reCaptcha][siteKey]" value="6LfSaV8UAAAAAEFq-7HeUDiSQCkCtLtO_yc_SOi_">'))
        .append($('<input type="hidden" name="options[reCaptcha][secret]" value="m+3RnHyrnk8L/SgOmrOjOwD92MLGNdbJvHUm7Ml6EyrIKOWGNffdxqKK9AtKcInmiUGaqMrM6W6jInER4Jy+gn/rf4Hai0TmhaxhukqLibAUl1UWhWUaZK1nn/yecE0y9wXOW8JaHtxODjVei0+bNgHl5JITjL/qaNszf+OCTEw=">'))
        .append($replyTo)
        .append($authorEmailEncrypted)
        .append($authorEmailMD5)
        .append($('<div class="form-group"><label>Name (optional)</label></div>').append($name))
        .append($('<div class="form-group"><label>Email (optional; always encrypted, never shared)</label></div>').append($email))
        .append($('<div class="form-group"><label>Url (optional; must start with "http://" or "https://")</label></div>').append($url))
        .append($('<div class="form-group"><label>Message (supports some Markdown/HTML)</label></div>').append($message));
    if (comment) {
        $replyTo.val(comment._id);
    }
    $form.submit(function (e) {
        e.preventDefault();
        hideForm();
        var post = $.post($form.attr('action'), $form.serialize(), "json");
        post.done(function () {
            alert("Comment successfully posted. It should appear on this page in a minute or so.");
        });
        post.error(function () {
            var message = "Failed to post comment";
            if (post.responseJSON && post.responseJSON.message)
                message += ": " + post.responseJSON.message;
            else if (post.responseJSON)
                message += ": " + post.responseJSON;
            alert(message);
        });
    });

    function createComment() {
        return normalizeComment({
            date: moment().format(),
            _id: "_",
            replyTo: comment ? comment._id : undefined,
            authorName: $name.val(),
            authorEmailMD5: $authorEmailMD5.val(),
            authorUri: $url.val(),
            message: $message.val()
        });
    };

    function recreatePreview() {
        var email = $email.val();
        if (email && email.indexOf("@") !== -1) {
            var data = new TextEncoder().encode($email.val());
            window.crypto.subtle.importKey("jwk", jwk, { name: "RSA-OAEP", hash: { name: "SHA-1" } }, false, ["encrypt"]).then(function (encryptionKey) {
                return window.crypto.subtle.encrypt({ name: "RSA-OAEP" }, encryptionKey, data)
                    .then(function (encrypted) {
                        var array = new Uint8Array(encrypted);
                        var text = base64js.fromByteArray(array);
                        $authorEmailEncrypted.val(text);
                        return text;
                    });
            });
            $authorEmailMD5.val(md5($email.val().replace(/^ +| +$/g, '').toLowerCase()));
        } else {
            $authorEmailMD5.val("");
            $authorEmailEncrypted.val("");
        }

        var $newPreview = $comment(false, createComment());
        // Turn off permalink and anchor
        var $anchor = $newPreview.find('.comment-date a');
        $anchor.replaceWith($('<span/>').text($anchor.text()));
        $newPreview.find('.comment-anchor').remove();
        $previewDiv.empty();
        $previewDiv.append($newPreview);
    };

    recreatePreview();
    $name.on('change keyup input paste', recreatePreview);
    $email.on('change keyup input paste', recreatePreview);
    $url.on('change keyup input paste', recreatePreview);
    $message.on('change keyup input paste', recreatePreview);

    $form.append($('<h3>Preview:</h3>'), $previewDiv, $buttonBar);
    return {
        $form: $('<div class="comment-form"/>').append($form),
        onShow: function() { grecaptcha.render($recaptcha[0]); }
    };
}

function $replyButton(comment) {
    var $button;
    if (comment)
        $button = $('<button class="btn btn-primary comment-reply"><i class="fa fa-reply"></i> Reply</button>');
    else
        $button = $('<button class="btn btn-primary comment-new"><i class="fa fa-plus-square"></i> New Comment</button>');
    return $button;
}

var now = moment();
function $comment(includeForm, comment) {
    var message = sanitizeHtml(markdownConverter.makeHtml(comment.message), sanitizeOptions);
    var $commentDiv = $('<div class="comment"/>');
    var publicationDate = moment(comment.date);
    var $author = $('<div class="comment-author"/>').append($('<span class="comment-author-name"/>').text(comment.authorName));
    if (comment.authorUri !== "")
        $author.append($('<span> • </span>'), $('<a class="comment-author-uri" rel="nofollow noopener"/>').attr('href', comment.authorUri).text(comment.authorUri));
    var $headerDiv = $('<div class="comment-header"/>').append(
        $('<div class="comment-author-profile" style="float:left;"/>').append($('<img class="comment-author-profile-image" src="' + avatarUri(comment.authorEmailMD5) + '"/>')),
        $author,
        $('<div class="comment-date" />').append(
            $('<a/>').attr('href', '#' + commentId(comment._id)).attr('title', 'permalink').text(publicationDate.from(now) + ' (' + publicationDate.format('YYYY-MM-DD hh:mm:ss a') + ')')
        )
    );
    if (comment.replyTo !== "") {
        var parent = comments.filter(function (x) { return x._id === comment.replyTo })[0];
        $headerDiv.append($('<div/>').append($('<a/>').attr('href', '#' + commentId(comment.replyTo)).text('In reply to ' + parent.authorName)));
    }

    $commentDiv.append($('<div class="comment-anchor"/>').attr('id', commentId(comment._id)),
        $headerDiv,
        $('<div class="comment-message" style="clear:both;"/>').html(message)
    );

    var $commentContainer = $('<div class="comment-container"/>').append($commentDiv);
    if (includeForm)
        $commentContainer.append($expandCollapseForm(comment));
    var childComments = filterComments(comment._id);
    for (var i = 0; i != childComments.length; ++i) {
        var child = childComments[i];
        $commentContainer.append($comment(includeForm, child));
    }

    return $commentContainer;
}

function normalizeComment(x) {
    var uri = x.authorUri;
    if (!uri || (!uri.startsWith("http://") && !uri.startsWith("https://")))
        uri = "";
    return {
            _id: x._id,
            authorName: x.authorName || "Anonymous",
            authorEmailMD5: x.authorEmailMD5 || "",
            authorUri: uri,
            message: x.message || "",
            replyTo: x.replyTo || "",
            date: x.date,
            timestamp: moment(x.date).valueOf()
    };
}

function $expandCollapseForm(comment) {
    var $button = $replyButton(comment);
    var formObj = $commentForm(hideForm, comment);
    var $form = formObj.$form.addClass("comment-hidden");
    var onShow = formObj.onShow;
    function showForm() {
        $button.addClass("comment-hidden");
        if (onShow) {
            onShow();
            onShow = null;
        }
        $form.removeClass("comment-hidden");
    }
    function hideForm() {
        $form.addClass("comment-hidden");
        $button.removeClass("comment-hidden");
    }
    $button.click(showForm);
    return $('<div/>').append($button, $form);
}

function recaptchaLoaded() {
    var req = new XMLHttpRequest();
    req.addEventListener("load", function () {
        var $commentDiv = $('#comments');
        if (req.status === 200)
        {
            comments = JSON.parse(req.responseText).map(normalizeComment);
            var commentCounter = document.getElementById('comment-counter');
            commentCounter.innerText = comments.length + " " + commentCounter.innerText;
            var toplevelComments = filterComments("");
            for (var i = 0; i != toplevelComments.length; ++i) {
                var comment = toplevelComments[i];
                $commentDiv.append($comment(true, comment));
            }
            $commentDiv.append($expandCollapseForm());
        }
        $commentDiv.prepend($expandCollapseForm());
    });
    req.open('GET', "https://comments.stephencleary.com/" + postId + ".json");
    req.send();
}
</script>

<script src="https://www.google.com/recaptcha/api.js?onload=recaptchaLoaded&amp;render=explicit"></script>



<!-- Google AdSense -->
<script src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- Moment -->
<script type="text/javascript">
    (function($) {
        $(function () {
            $('time').each(function (_, e) {
                var startOfToday = moment().startOf('day');
                var publicationDate = moment($(e).attr('datetime'), 'YYYY-MM-DD');
                var difference = startOfToday.diff(publicationDate, 'days');
                var text = difference === 0 ? 'Today' :
                    difference === 1 ? 'Yesterday' :
                    publicationDate.from(startOfToday);
                $(e).text(function(_, oldText) { return text + ' (' + oldText + ')'; });
            });
        });
    })(window.jQuery);
</script>




</body>
</html>